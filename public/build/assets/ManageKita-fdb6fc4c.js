import{d as ne}from"./index-3453eb14.js";import{K as re,k as w,h as ue,m as ie,T as D,r as d,n as de,o as P,f as ce,a as e,u,w as l,F as me,Z as _e,b as r,p as _,d as m,i as W,c as G,g as fe,t as K,q as pe,s as ve}from"./app-9252ff73.js";import{_ as ge}from"./AuthenticatedLayout-a7b7c841.js";import"./sortable.esm-0d19b1d3.js";import"./ApplicationLogo-f1a145c5.js";const he=r("h2",{class:"tw-font-semibold tw-text-xl tw-text-gray-800 tw-leading-tight"},"Verwalte Kita",-1),ke={class:"tw-table-block tw-max-w-full tw-mx-auto tw-py-6 tw-px-4 sm:tw-px-6 lg:tw-px-8"},be=r("h3",null,"Eigenschaften",-1),we=r("h3",null,"Zugeordnete Benutzer",-1),Ve={class:"tw-flex tw-items-center tw-justify-end"},ye=r("span",{class:"tw-text-h5"},"Verbinden Benutzer",-1),ze=r("p",null,"Wählen Sie die Benutzer aus, die Sie diesem Kita hinzufügen möchten",-1),Ce=r("span",{class:"tw-text-h5"},"Neue Benutzer",-1),Ue=["data-id","data-order"],xe={align:"center"},Ke={align:"center"},Se=r("span",null,"Benutzer bearbeiten",-1),Be=r("span",null,"Benutzer löschen",-1),Ee=r("div",{class:"tw-py-6"},[r("h3",{class:"tw-mb-4"},"Die Tabelle ist leer.")],-1),$e={__name:"ManageKita",props:{kita:Object,errors:Object,roles:Array,users:Array},setup(U){const S=U;ne.Inertia.on("success",s=>{let t=s.detail.page.props;s.detail.page.component==="Kita/Partials/ManageKita"&&t&&(z.value=t.kita)}),re().props.auth.user;const z=w(S.kita),f=w(S.errors||{}),H=w(!1);w(null);const j=w(null),B=w(!1),N=w(!1),E=w(!1),J=[{title:"Status",key:"is_online",width:"5%",sortable:!1,align:"center"},{title:"Vorname",key:"first_name",width:"20%",sortable:!1},{title:"Nachname",key:"last_name",width:"25%",sortable:!1},{title:"E-Mail",key:"email",width:"20%",sortable:!1},{title:"Rolle",key:"primary_role_name",width:"20%",sortable:!1},{title:"Aktion",key:"actions",width:"10%",sortable:!1,align:"center"}],Q=ue(()=>S.kita.users.map(s=>{const t={...s};for(const n in t)(t[n]===null||t[n]===void 0)&&(t[n]="-");return t}));ie(B,s=>{s||b()});const b=()=>{B.value=!1,N.value=!1,E.value=!1,i.reset(),i.clearErrors(),k.reset(),k.clearErrors(),f.value={}},Z=()=>{i.reset(),i.clearErrors(),k.reset(),k.clearErrors(),v.reset(),v.clearErrors(),v.zip_code=!1,v.name=null},X=s=>{j.value=s.full_name,F.user=s.id,E.value=!0},F=D({user:null}),Y=async()=>{F.processing=!0;let s={onSuccess:t=>{b()},onError:t=>{f.value=t},onFinish:()=>{F.processing=!1}};F.post(route("kitas.disconnect_user",{id:S.kita.id}),s)},v=D({id:z.value.id,name:z.value.name,zip_code:z.value.zip_code}),ee=async()=>{v.processing=!0;let s={preserveState:!1,onSuccess:t=>{b()},onError:t=>{f.value=t},onFinish:()=>{v.processing=!1}};v.put(route("kitas.update",{kita:v.id}),s)},i=D({first_name:null,last_name:null,email:null,role:null,two_factor_auth_enabled:!1,kitas:[z.value.id]}),le=async()=>{i.processing=!0,i.post(route("users.store_from_kita"),{onSuccess:s=>{b()},onError:s=>{f.value=s},onFinish:()=>{i.processing=!1}})},k=D({users:null,kitas:[z.value.id]}),te=async()=>{k.processing=!0,k.post(route("kitas.connect_users",{kita:i.kitas}),{onSuccess:s=>{b()},onError:s=>{f.value=s},onFinish:()=>{k.processing=!1}})};return(s,t)=>{const n=d("v-col"),g=d("v-row"),V=d("v-container"),x=d("v-text-field"),y=d("v-btn"),p=d("v-hover"),C=d("v-btn-primary"),M=d("v-card-title"),L=d("v-select"),q=d("v-card-text"),$=d("v-spacer"),A=d("v-card-actions"),T=d("v-card"),I=d("v-dialog"),ae=d("v-checkbox"),O=d("v-icon"),R=d("v-tooltip"),oe=d("v-data-table-server"),se=de("sortable-data-table");return P(),ce(me,null,[e(u(_e),{title:`Verwalte Kita ${U.kita.name}`},null,8,["title"]),e(ge,{errors:f.value},{header:l(()=>[he]),default:l(()=>[r("div",ke,[e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[be]),_:1})]),_:1})]),_:1}),e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12",sm:"9"},{default:l(()=>[e(x,{modelValue:u(v).name,"onUpdate:modelValue":t[0]||(t[0]=a=>u(v).name=a),"error-messages":f.value.name,label:"Name der Einrichtung / Kita*",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(n,{cols:"12",sm:"3"},{default:l(()=>[e(x,{modelValue:u(v).zip_code,"onUpdate:modelValue":t[1]||(t[1]=a=>u(v).zip_code=a),"error-messages":f.value.zip_code,label:"Postleitzahl*",type:"number",required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(n,{cols:"12",sm:"6"},{default:l(()=>[e(p,null,{default:l(({isHovering:a,props:c})=>[e(y,_({onClick:Z},c,{color:a?"primary":"accent"}),{default:l(()=>[m("Zurücksetzen")]),_:2},1040,["color"])]),_:1})]),_:1}),e(n,{cols:"12",sm:"6",align:"right"},{default:l(()=>[e(p,null,{default:l(({isHovering:a,props:c})=>[e(u(W),{href:s.route("kitas.index")},{default:l(()=>[e(y,_({class:"mr-2",variant:"text"},c,{color:a?"accent":"primary"}),{default:l(()=>[m("Zurück")]),_:2},1040,["color"])]),_:2},1032,["href"])]),_:1}),e(p,null,{default:l(({isHovering:a,props:c})=>[e(C,_({onClick:ee},c,{color:a?"accent":"primary"}),{default:l(()=>[m("Speichern ")]),_:2},1040,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),e(V,null,{default:l(()=>[e(g,{class:"tw-border-t-8 tw-mt-8 tw-pt-8"},{default:l(()=>[e(n,{cols:"12",sm:"6"},{default:l(()=>[we]),_:1}),e(n,{cols:"12",sm:"6"},{default:l(()=>[r("div",Ve,[s.$page.props.auth.user.is_super_admin||s.$page.props.auth.user.is_admin?(P(),G(p,{key:0},{default:l(({isHovering:a,props:c})=>[e(y,_(c,{color:a?"accent":"primary",dark:"",class:"mr-2"}),{default:l(()=>[m(" Benutzer verbinden "),e(I,{modelValue:N.value,"onUpdate:modelValue":t[3]||(t[3]=o=>N.value=o),activator:"parent",width:"80vw"},{default:l(()=>[e(T,{height:"80vh"},{default:l(()=>[e(M,null,{default:l(()=>[ye]),_:1}),e(q,null,{default:l(()=>[e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[ze]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[e(L,{modelValue:u(k).users,"onUpdate:modelValue":t[2]||(t[2]=o=>u(k).users=o),items:U.users,"error-messages":f.value.users,"item-title":"full_name","item-value":"id",label:"User",multiple:"",required:""},null,8,["modelValue","items","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),e(A,null,{default:l(()=>[e(p,null,{default:l(({isHovering:o,props:h})=>[e(C,_({onClick:Z},h,{color:o?"primary":"accent"}),{default:l(()=>[m("Zurücksetzen")]),_:2},1040,["color"])]),_:2},1024),e($),e(p,null,{default:l(({isHovering:o,props:h})=>[e(y,_({onClick:b},h,{color:o?"accent":"primary"}),{default:l(()=>[m("Zurück")]),_:2},1040,["color"])]),_:2},1024),e(p,null,{default:l(({isHovering:o,props:h})=>[e(C,_({onClick:te},h,{color:o?"accent":"primary"}),{default:l(()=>[m("Speichern")]),_:2},1040,["color"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1040,["color"])]),_:1})):fe("",!0),e(p,null,{default:l(({isHovering:a,props:c})=>[e(y,_(c,{color:a?"accent":"primary",dark:""}),{default:l(()=>[m(" Benutzer hinzufügen "),e(I,{modelValue:B.value,"onUpdate:modelValue":t[9]||(t[9]=o=>B.value=o),activator:"parent",width:"80vw"},{default:l(()=>[e(T,{height:"80vh"},{default:l(()=>[e(M,null,{default:l(()=>[Ce]),_:1}),e(q,null,{default:l(()=>[e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12",sm:"6"},{default:l(()=>[e(x,{modelValue:u(i).first_name,"onUpdate:modelValue":t[4]||(t[4]=o=>u(i).first_name=o),"error-messages":f.value.first_name,label:"Vorname",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:l(()=>[e(x,{modelValue:u(i).last_name,"onUpdate:modelValue":t[5]||(t[5]=o=>u(i).last_name=o),"error-messages":f.value.last_name,label:"Nachname",required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(n,{cols:"12",sm:"6"},{default:l(()=>[e(x,{modelValue:u(i).email,"onUpdate:modelValue":t[6]||(t[6]=o=>u(i).email=o),"error-messages":f.value.email,label:"Email",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:l(()=>[e(L,{modelValue:u(i).role,"onUpdate:modelValue":t[7]||(t[7]=o=>u(i).role=o),items:U.roles,"error-messages":f.value.role,"item-title":"human_name","item-value":"id",label:"Role",required:""},null,8,["modelValue","items","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(n,{cols:"12",md:"4",sm:"6"},{default:l(()=>[e(ae,{modelValue:u(i).two_factor_auth_enabled,"onUpdate:modelValue":t[8]||(t[8]=o=>u(i).two_factor_auth_enabled=o),label:"Zwei-Faktor-Authentifizierung",value:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(A,null,{default:l(()=>[e(p,null,{default:l(({isHovering:o,props:h})=>[e(C,_({onClick:Z},h,{color:o?"primary":"accent"}),{default:l(()=>[m("Zurücksetzen")]),_:2},1040,["color"])]),_:2},1024),e($),e(p,null,{default:l(({isHovering:o,props:h})=>[e(y,_({onClick:b},h,{color:o?"accent":"primary"}),{default:l(()=>[m("Zurück")]),_:2},1040,["color"])]),_:2},1024),e(p,null,{default:l(({isHovering:o,props:h})=>[e(C,_({onClick:le},h,{color:o?"accent":"primary"}),{default:l(()=>[m("Speichern")]),_:2},1040,["color"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1040,["color"])]),_:1})])]),_:1})]),_:1})]),_:1}),e(V,null,{default:l(()=>[e(I,{modelValue:E.value,"onUpdate:modelValue":t[10]||(t[10]=a=>E.value=a),width:"20vw"},{default:l(()=>[e(T,{height:"30vh"},{default:l(()=>[e(q,null,{default:l(()=>[e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[r("p",null,"Sind Sie sicher, dass Sie den Benutzer "+K(j.value)+" aus Kita Liste löschen möchten? (Der Benutzer wird vom aktuellen Kita getrennt)",1)]),_:1})]),_:1})]),_:1})]),_:1}),e(A,null,{default:l(()=>[e($),e(p,null,{default:l(({isHovering:a,props:c})=>[e(y,_({onClick:b},c,{color:a?"accent":"primary"}),{default:l(()=>[m("Abbrechen")]),_:2},1040,["color"])]),_:1}),e(p,null,{default:l(({isHovering:a,props:c})=>[e(C,_({onClick:Y},c,{color:a?"accent":"primary"}),{default:l(()=>[m("Löschen")]),_:2},1040,["color"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[pe((P(),G(oe,{"items-per-page":-1,headers:J,items:Q.value,loading:H.value,class:"data-table-container data-table-container-hide-footer elevation-1","item-value":"name"},{item:l(({item:a})=>[r("tr",{"data-id":a.selectable.id,"data-order":a.selectable.order},[r("td",xe,[e(O,{size:"medium",class:ve({active:a.selectable.is_online})},{default:l(()=>[m("mdi-circle")]),_:2},1032,["class"])]),r("td",null,K(a.selectable.first_name),1),r("td",null,K(a.selectable.last_name),1),r("td",null,K(a.selectable.email),1),r("td",null,K(a.selectable.primary_role_human_name),1),r("td",Ke,[e(R,{location:"top"},{activator:l(({props:c})=>[e(u(W),{href:`${s.route("users.edit",{id:a.selectable.id})}?from=kitas.show;${U.kita.id}`},{default:l(()=>[e(O,_(c,{size:"small",class:"tw-me-2"}),{default:l(()=>[m("mdi-pencil")]),_:2},1040)]),_:2},1032,["href"])]),default:l(()=>[Se]),_:2},1024),e(R,{location:"top"},{activator:l(({props:c})=>[e(O,_(c,{size:"small",class:"tw-me-2",onClick:o=>X(a.raw)}),{default:l(()=>[m("mdi-delete ")]),_:2},1040,["onClick"])]),default:l(()=>[Be]),_:2},1024)])],8,Ue)]),"no-data":l(()=>[Ee]),_:1},8,["items","loading"])),[[se]])]),_:1})]),_:1})]),_:1})])]),_:1},8,["errors"])],64)}}};export{$e as default};
