import{d as Le}from"./index-4f7f5251.js";import{K as Ne,h as r,j as H,k as z,A as ve,T as Q,r as u,o as P,f as W,a as e,u as m,w as l,F as pe,Z as $e,b as n,m as g,d as b,q as Be,t as x,c as q,g as I,i as Ce,O as xe}from"./app-1577d11b.js";import{c as fe,b as Ae,f as De}from"./common-ea192878.js";import{_ as Te}from"./AuthenticatedLayout-9aa6d989.js";import"./ApplicationLogo-61efe87b.js";const Oe=n("h2",{class:"tw-font-semibold tw-text-xl tw-text-gray-800 tw-leading-tight"},"Benutzer",-1),je={class:"tw-flex tw-items-center tw-justify-end"},qe=n("span",{class:"tw-text-h5"},"Neuen Benutzer",-1),Ie=n("p",null,"Sind Sie sicher, dass Sie den aktuellen Benutzer löschen möchten?",-1),Re={class:"tw-table-block tw-max-w-full tw-mx-auto tw-py-6 tw-px-4 sm:tw-px-6 lg:tw-px-8"},Ze={class:"tw-bg-white tw-flex tw-justify-between tw-px-6 tw-py-6"},Je={class:"tw-w-full"},Ke={align:"center"},Me={class:"tw-flex tw-items-center"},Ge=n("span",null,"E-Mail wurde nicht verifiziert",-1),He={class:"tw-text-center"},Qe=n("span",null,"Verifikations-Email erneut senden",-1),We=n("span",null,"Benutzer bearbeiten",-1),Xe=n("span",null,"Benutzer löschen",-1),Ye={class:"tw-py-6"},el={key:0,class:"tw-mb-4"},ll=n("h3",{class:"tw-mb-4"},"Die Tabelle ist leer. Bitte setzen Sie die Suchfilter zurück.",-1),rl={__name:"Users",props:{items:Array,currentPage:Number,perPage:Number,lastPage:Number,total:Number,paging:Boolean,orderBy:String,sort:String,filters:Object,errors:Object,roles:Array},setup(R){const p=R;Le.Inertia.on("success",o=>{let t=o.detail.page.props;o.detail.page.component==="Users/Users"&&t&&(A.value=t.currentPage,$.value=t.perPage,ge.value=t.orderBy,be.value=t.sort,X.value=t.total,we.value=t.lastPage)}),Ne().props.auth.user;const A=r(p.currentPage),$=r(p.perPage),ge=r(p.orderBy),be=r(p.sort),X=r(p.total),we=r(p.lastPage),y=r(p.filters.status??null),k=r(p.filters.full_name??null),S=r(p.filters.email??null),F=r(null),Y=r(""),w=r(p.errors||{}),Z=r(!1),J=r(!1),U=r(!1),D=r(!1),T=r(!1),ee=r(null),le=r(null),V=r(null),h=r(null),he=[{title:"Status",key:"is_online",width:"5%",sortable:!1,align:"center"},{title:"Name",key:"first_name",width:"20%",sortable:!0},{title:"Email",key:"email",width:"30%",sortable:!0},{title:"Rolle",key:"primary_role_name",width:"10%",sortable:!0},{title:"Letzter Login",key:"last_seen_at",width:"15%",sortable:!0},{title:"Erster Login",key:"first_login_at",width:"10%",sortable:!0},{title:"Aktionen",key:"actions",width:"10%",sortable:!1,align:"center"}],Ve=[{title:"Ja",value:"true"},{title:"Nein",value:"false"}],ye=H(()=>p.items.map(o=>{const t={...o};for(const c in t)(t[c]===null||t[c]===void 0)&&(t[c]="-");return t})),te=H(()=>y.value===null&&k.value===null&&S.value===null&&F.value===null&&V.value===null&&h.value===null),ke=H(()=>y.value!==null||k.value!==null||S.value!==null||F.value!==null||V.value!==null||h.value!==null);z(D,o=>{o||N()}),z(y,o=>{E()}),z(k,ve.debounce(o=>{E()},500)),z(S,ve.debounce(o=>{E()},500)),z(F,o=>{E()}),z(V,o=>{ee.value=o?fe(o):null,E()}),z(h,o=>{le.value=o?fe(o):null,E()});const E=()=>{U.value=!0,Y.value=String(Date.now())},ae=async({page:o,itemsPerPage:t,sortBy:c,clearFilters:f})=>{if(f&&(y.value=null,k.value=null,S.value=null,F.value=null,V.value=null,h.value=null),o===A.value&&f||te||ke){U.value=!0;let s={page:o,per_page:t};c&&c.length>0?(s.order_by=c[0].key,s.sort=c[0].order):(s.order_by=null,s.sort=null),y.value&&(s.status=y.value),k.value&&(s.full_name=k.value),S.value&&(s.email=S.value),F.value&&(s.with_roles=F.value),V.value&&(s.first_login_at=V.value.toLocaleString()),h.value&&(console.log(h.value.toLocaleString()),s.last_seen_at=h.value.toLocaleString()),await xe.get(route(route().current()),s,{preserveScroll:!0,preserveState:!0,onCancelToken:_=>{},onCancel:()=>{},onBefore:_=>{U.value=!0},onStart:_=>{},onProgress:_=>{},onSuccess:_=>{A.value=s.page,$.value=s.per_page},onError:_=>{console.log(_)},onFinish:_=>{U.value=!1}})}},Se=o=>{L.id=o.id,T.value=!0},L=Q({id:null}),Fe=async()=>{L.processing=!0;let o={onSuccess:t=>{N()},onError:t=>{w.value=t},onFinish:()=>{L.processing=!1}};L.delete(route("users.destroy",{id:L.id}),o)},N=()=>{D.value=!1,T.value=!1,L.id=null,d.reset(),d.clearErrors(),w.value={}},d=Q({first_name:null,last_name:null,email:null,role:null,two_factor_auth_enabled:!1,phone_number:null}),Ue=async()=>{d.processing=!0;let o={onSuccess:t=>{N()},onError:t=>{w.value=t},onFinish:()=>{d.processing=!1}};d.post(route("users.store"),o)},K=Q({}),ze=async o=>{K.processing=!0;let t={onSuccess:c=>{N()},onError:c=>{w.value=c},onFinish:()=>{K.processing=!1}};K.post(route("users.send_verification_link",{user:o==null?void 0:o.id}),t)};return(o,t)=>{const c=u("v-card-title"),f=u("v-text-field"),s=u("v-col"),_=u("v-row"),M=u("v-select"),Pe=u("v-checkbox"),oe=u("v-container"),se=u("v-card-text"),ne=u("v-spacer"),O=u("v-btn"),B=u("v-hover"),re=u("v-btn-primary"),ue=u("v-card-actions"),ie=u("v-card"),de=u("v-dialog"),me=u("v-date-picker"),ce=u("v-menu"),_e=u("v-locale-provider"),C=u("v-icon"),j=u("v-tooltip"),Ee=u("v-data-table-server");return P(),W(pe,null,[e(m($e),{title:"Benutzer"}),e(Te,{errors:w.value},{header:l(()=>[Oe,n("div",je,[e(B,null,{default:l(({isHovering:a,props:v})=>[e(O,g(v,{color:a?"accent":"primary",dark:""}),{default:l(()=>[b(" Neuen Benutzer hinzufügen "),e(de,{modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=i=>D.value=i),activator:"parent",width:"80vw"},{default:l(()=>[e(ie,{height:"80vh"},{default:l(()=>[e(c,null,{default:l(()=>[qe]),_:1}),e(se,null,{default:l(()=>[e(oe,null,{default:l(()=>[e(_,null,{default:l(()=>[e(s,{cols:"12",sm:"6"},{default:l(()=>[e(f,{modelValue:m(d).first_name,"onUpdate:modelValue":t[0]||(t[0]=i=>m(d).first_name=i),"error-messages":w.value.first_name,label:"Vorname",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12",sm:"6"},{default:l(()=>[e(f,{modelValue:m(d).last_name,"onUpdate:modelValue":t[1]||(t[1]=i=>m(d).last_name=i),"error-messages":w.value.last_name,label:"Nachname",required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(s,{cols:"12",sm:"6"},{default:l(()=>[e(f,{modelValue:m(d).email,"onUpdate:modelValue":t[2]||(t[2]=i=>m(d).email=i),"error-messages":w.value.email,label:"Email",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12",sm:"6"},{default:l(()=>[e(f,{modelValue:m(d).phone_number,"onUpdate:modelValue":t[3]||(t[3]=i=>m(d).phone_number=i),"error-messages":w.value.phone_number,label:"Telefonnummer"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(s,{cols:"12",sm:"6"},{default:l(()=>[e(M,{modelValue:m(d).role,"onUpdate:modelValue":t[4]||(t[4]=i=>m(d).role=i),items:R.roles,"error-messages":w.value.role,"item-title":"human_name","item-value":"id",label:"Role",required:""},null,8,["modelValue","items","error-messages"])]),_:1}),e(s,{cols:"12",md:"4",sm:"6"},{default:l(()=>[e(Pe,{modelValue:m(d).two_factor_auth_enabled,"onUpdate:modelValue":t[5]||(t[5]=i=>m(d).two_factor_auth_enabled=i),label:"Zwei-Faktor-Authentifizierung",value:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ue,null,{default:l(()=>[e(ne),e(B,null,{default:l(({isHovering:i,props:G})=>[e(O,g({onClick:N},G,{color:i?"accent":"primary"}),{default:l(()=>[b("Abbrechen")]),_:2},1040,["color"])]),_:2},1024),e(B,null,{default:l(({isHovering:i,props:G})=>[e(re,g({onClick:Ue},G,{color:i?"accent":"primary"}),{default:l(()=>[b("Speichern")]),_:2},1040,["color"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1040,["color"])]),_:1})]),e(de,{modelValue:T.value,"onUpdate:modelValue":t[7]||(t[7]=a=>T.value=a),width:"20vw"},{default:l(()=>[e(ie,{height:"30vh"},{default:l(()=>[e(se,null,{default:l(()=>[e(oe,null,{default:l(()=>[e(_,null,{default:l(()=>[e(s,{cols:"12"},{default:l(()=>[Ie]),_:1})]),_:1})]),_:1})]),_:1}),e(ue,null,{default:l(()=>[e(ne),e(B,null,{default:l(({isHovering:a,props:v})=>[e(O,g({onClick:N},v,{color:a?"accent":"primary"}),{default:l(()=>[b("Abbrechen")]),_:2},1040,["color"])]),_:1}),e(B,null,{default:l(({isHovering:a,props:v})=>[e(re,g({onClick:Fe},v,{color:a?"accent":"primary"}),{default:l(()=>[b("Löschen")]),_:2},1040,["color"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),default:l(()=>[n("div",Re,[n("div",Ze,[n("div",Je,[e(_,null,{default:l(()=>[e(s,{cols:"12",sm:"4"},{default:l(()=>[e(M,{modelValue:y.value,"onUpdate:modelValue":t[8]||(t[8]=a=>y.value=a),items:Ve,"item-title":"title","item-value":"value",label:"Status",multiple:"",disabled:U.value,clearable:""},null,8,["modelValue","disabled"])]),_:1}),e(s,{cols:"12",sm:"4"},{default:l(()=>[e(f,{modelValue:k.value,"onUpdate:modelValue":t[9]||(t[9]=a=>k.value=a),label:"Name",clearable:""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12",sm:"4"},{default:l(()=>[e(f,{modelValue:S.value,"onUpdate:modelValue":t[10]||(t[10]=a=>S.value=a),label:"Email",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,null,{default:l(()=>[e(s,{cols:"12",sm:"4"},{default:l(()=>[e(M,{modelValue:F.value,"onUpdate:modelValue":t[11]||(t[11]=a=>F.value=a),items:R.roles,"item-title":"human_name","item-value":"name",label:"Rolle",multiple:"",disabled:U.value,clearable:""},null,8,["modelValue","items","disabled"])]),_:1}),e(s,{cols:"12",sm:"4"},{default:l(()=>[e(_e,{locale:"de"},{default:l(()=>[e(ce,{modelValue:Z.value,"onUpdate:modelValue":t[14]||(t[14]=a=>Z.value=a),"return-value":V.value,"close-on-content-click":!1},{activator:l(({props:a})=>[e(f,g({label:"Erster Login",class:"tw-cursor-pointer","model-value":ee.value,"prepend-icon":"mdi-calendar",readonly:""},a),null,16,["model-value"])]),default:l(()=>[e(me,{"onUpdate:modelValue":[t[12]||(t[12]=a=>Z.value=!1),t[13]||(t[13]=a=>V.value=a)],modelValue:V.value},null,8,["modelValue"])]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),e(s,{cols:"12",sm:"4"},{default:l(()=>[e(_e,{locale:"de"},{default:l(()=>[e(ce,{modelValue:J.value,"onUpdate:modelValue":t[17]||(t[17]=a=>J.value=a),"return-value":h.value,"close-on-content-click":!1},{activator:l(({props:a})=>[e(f,g({label:"Letzter Login",class:"tw-cursor-pointer","model-value":le.value,"prepend-icon":"mdi-calendar",readonly:""},a),null,16,["model-value"])]),default:l(()=>[e(me,{"onUpdate:modelValue":[t[15]||(t[15]=a=>J.value=!1),t[16]||(t[16]=a=>h.value=a)],modelValue:h.value},null,8,["modelValue"])]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1})]),_:1})])]),e(Ee,{"items-per-page":$.value,"onUpdate:itemsPerPage":t[19]||(t[19]=a=>$.value=a),headers:he,page:A.value,"items-length":X.value,items:ye.value,search:Y.value,loading:U.value,class:"data-table-container elevation-1","item-value":"name","onUpdate:options":ae},{item:l(({item:a})=>[n("tr",null,[n("td",Ke,[e(C,{size:"medium",class:Be({active:a.is_online})},{default:l(()=>[b("mdi-circle")]),_:2},1032,["class"])]),n("td",null,x(a.full_name),1),n("td",null,[n("div",Me,[!a.email_verified_at||a.email_verified_at==="-"?(P(),q(j,{key:0},{activator:l(({props:v})=>[e(C,g(v,{size:"small",class:"tw-me-2"}),{default:l(()=>[b("mdi-alert-circle")]),_:2},1040)]),default:l(()=>[Ge]),_:1})):I("",!0),n("span",null,x(a.email),1)])]),n("td",null,x(a.primary_role_human_name),1),n("td",null,x(!a.last_seen_at||a.last_seen_at==="-"?a.last_seen_at:m(Ae)(a.last_seen_at,"de-DE")),1),n("td",null,x(!a.first_login_at||a.first_login_at==="-"?a.first_login_at:m(De)(a.first_login_at,"de-DE")),1),n("td",He,[(o.$page.props.auth.user.is_super_admin||o.$page.props.auth.user.is_admin)&&(!a.email_verified_at||a.email_verified_at==="-")?(P(),q(j,{key:0,location:"top"},{activator:l(({props:v})=>[e(C,g(v,{size:"small",class:"tw-me-2",onClick:i=>ze(a)}),{default:l(()=>[b("mdi-email-sync-outline")]),_:2},1040,["onClick"])]),default:l(()=>[Qe]),_:2},1024)):I("",!0),o.$page.props.auth.user.is_super_admin||(o.$page.props.auth.user.is_admin||o.$page.props.auth.user.is_manager)&&!a.is_super_admin&&!a.is_admin||o.$page.props.auth.user.is_admin&&o.$page.props.auth.user.id===a.id?(P(),q(j,{key:1,location:"top"},{activator:l(({props:v})=>[e(m(Ce),{href:o.route("users.edit",{id:a.id})},{default:l(()=>[e(C,g(v,{size:"small",class:"tw-me-2"}),{default:l(()=>[b("mdi-pencil")]),_:2},1040)]),_:2},1032,["href"])]),default:l(()=>[We]),_:2},1024)):I("",!0),o.$page.props.auth.user.is_super_admin||o.$page.props.auth.user.is_admin||o.$page.props.auth.user.is_manager&&!a.is_super_admin&&!a.is_admin?(P(),q(j,{key:2,location:"top"},{activator:l(({props:v})=>[e(C,g(v,{size:"small",class:"tw-me-2",onClick:i=>Se(a)}),{default:l(()=>[b("mdi-delete")]),_:2},1040,["onClick"])]),default:l(()=>[Xe]),_:2},1024)):I("",!0)])])]),"no-data":l(()=>[n("div",Ye,[te.value?(P(),W("h3",el,"Die Tabelle ist leer.")):(P(),W(pe,{key:1},[ll,e(O,{color:"primary",onClick:t[18]||(t[18]=a=>ae({page:1,itemsPerPage:$.value,clearFilters:!0}))},{default:l(()=>[b("Zurücksetzen")]),_:1})],64))])]),_:1},8,["items-per-page","page","items-length","items","search","loading"])])]),_:1},8,["errors"])],64)}}};export{rl as default};
