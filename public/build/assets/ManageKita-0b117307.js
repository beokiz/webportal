import{d as se}from"./index-fba5070c.js";import{K as ne,k,h as re,m as ue,T as D,r as d,n as ie,o as R,f as de,a as e,u,w as l,F as ce,Z as me,b as r,p as _,d as m,i as W,t as K,q as _e,c as fe,s as pe}from"./app-f3df4d77.js";import{_ as ve}from"./AuthenticatedLayout-2cc29830.js";import"./sortable.esm-0d19b1d3.js";import"./ApplicationLogo-5ce5301f.js";const ge=r("h2",{class:"tw-font-semibold tw-text-xl tw-text-gray-800 tw-leading-tight"},"Verwalte Kita",-1),he={class:"tw-table-block tw-max-w-full tw-mx-auto tw-py-6 tw-px-4 sm:tw-px-6 lg:tw-px-8"},be=r("h3",null,"Eigenschaften",-1),we=r("h3",null,"Zugeordnete Benutzer",-1),ke={class:"tw-flex tw-items-center tw-justify-end"},Ve=r("span",{class:"tw-text-h5"},"Verbinden Benutzer",-1),ye=r("p",null,"Wählen Sie die Benutzer aus, die Sie diesem Kita hinzufügen möchten",-1),ze={class:"tw-flex tw-items-center tw-justify-end"},xe=r("span",{class:"tw-text-h5"},"Neue Benutzer",-1),Ue=["data-id","data-order"],Ce={align:"center"},Ke={align:"center"},Se=r("span",null,"Benutzer bearbeiten",-1),Be=r("span",null,"Benutzer löschen",-1),Ee=r("div",{class:"tw-py-6"},[r("h3",{class:"tw-mb-4"},"Die Tabelle ist leer.")],-1),Ae={__name:"ManageKita",props:{kita:Object,errors:Object,roles:Array,users:Array},setup(U){const S=U;se.Inertia.on("success",s=>{let t=s.detail.page.props;s.detail.page.component==="Kita/Partials/ManageKita"&&t&&(z.value=t.kita)}),ne().props.auth.user;const z=k(S.kita),f=k(S.errors||{}),G=k(!1);k(null);const O=k(null),B=k(!1),Z=k(!1),E=k(!1),H=[{title:"Status",key:"is_online",width:"5%",sortable:!1,align:"center"},{title:"Vorname",key:"first_name",width:"20%",sortable:!1},{title:"Nachname",key:"last_name",width:"25%",sortable:!1},{title:"E-Mail",key:"email",width:"20%",sortable:!1},{title:"Rolle",key:"primary_role_name",width:"20%",sortable:!1},{title:"Aktion",key:"actions",width:"10%",sortable:!1,align:"center"}],J=re(()=>S.kita.users.map(s=>{const t={...s};for(const n in t)(t[n]===null||t[n]===void 0)&&(t[n]="-");return t}));ue(B,s=>{s||w()});const w=()=>{B.value=!1,Z.value=!1,E.value=!1,i.reset(),i.clearErrors(),b.reset(),b.clearErrors(),f.value={}},q=()=>{i.reset(),i.clearErrors(),b.reset(),b.clearErrors(),v.reset(),v.clearErrors(),v.zip_code=!1,v.name=null},Q=s=>{O.value=s.full_name,F.user=s.id,E.value=!0},F=D({user:null}),X=async()=>{F.processing=!0;let s={onSuccess:t=>{w()},onError:t=>{f.value=t},onFinish:()=>{F.processing=!1}};F.post(route("kitas.disconnect_user",{id:S.kita.id}),s)},v=D({id:z.value.id,name:z.value.name,zip_code:z.value.zip_code}),Y=async()=>{v.processing=!0;let s={preserveState:!1,onSuccess:t=>{w()},onError:t=>{f.value=t},onFinish:()=>{v.processing=!1}};v.put(route("kitas.update",{kita:v.id}),s)},i=D({first_name:null,last_name:null,email:null,role:null,two_factor_auth_enabled:!1,kitas:[z.value.id]}),ee=async()=>{i.processing=!0,i.post(route("users.store"),{preserveState:!1,onSuccess:s=>{w()},onError:s=>{f.value=s},onFinish:()=>{i.processing=!1}})},b=D({users:null,kitas:[z.value.id]}),le=async()=>{b.processing=!0,b.post(route("kitas.connect_users",{kita:i.kitas}),{preserveState:!1,onSuccess:s=>{w()},onError:s=>{f.value=s},onFinish:()=>{b.processing=!1}})};return(s,t)=>{const n=d("v-col"),g=d("v-row"),V=d("v-container"),C=d("v-text-field"),y=d("v-btn"),p=d("v-hover"),x=d("v-btn-primary"),P=d("v-card-title"),M=d("v-select"),N=d("v-card-text"),A=d("v-spacer"),T=d("v-card-actions"),$=d("v-card"),j=d("v-dialog"),te=d("v-checkbox"),I=d("v-icon"),L=d("v-tooltip"),ae=d("v-data-table-server"),oe=ie("sortable-data-table");return R(),de(ce,null,[e(u(me),{title:`Verwalte Kita ${U.kita.name}`},null,8,["title"]),e(ve,{errors:f.value},{header:l(()=>[ge]),default:l(()=>[r("div",he,[e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[be]),_:1})]),_:1})]),_:1}),e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12",sm:"9"},{default:l(()=>[e(C,{modelValue:u(v).name,"onUpdate:modelValue":t[0]||(t[0]=a=>u(v).name=a),"error-messages":f.value.name,label:"Name der Einrichtung / Kita*",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(n,{cols:"12",sm:"3"},{default:l(()=>[e(C,{modelValue:u(v).zip_code,"onUpdate:modelValue":t[1]||(t[1]=a=>u(v).zip_code=a),"error-messages":f.value.zip_code,label:"Postleitzahl*",type:"number",required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(n,{cols:"12",sm:"6"},{default:l(()=>[e(p,null,{default:l(({isHovering:a,props:c})=>[e(y,_({onClick:q},c,{color:a?"primary":"accent"}),{default:l(()=>[m("Zurücksetzen")]),_:2},1040,["color"])]),_:1})]),_:1}),e(n,{cols:"12",sm:"6",align:"right"},{default:l(()=>[e(p,null,{default:l(({isHovering:a,props:c})=>[e(u(W),{href:s.route("kitas.index")},{default:l(()=>[e(y,_({class:"mr-2",variant:"text"},c,{color:a?"accent":"primary"}),{default:l(()=>[m("Zurück")]),_:2},1040,["color"])]),_:2},1032,["href"])]),_:1}),e(p,null,{default:l(({isHovering:a,props:c})=>[e(x,_({onClick:Y},c,{color:a?"accent":"primary"}),{default:l(()=>[m("Speichern ")]),_:2},1040,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),e(V,null,{default:l(()=>[e(g,{class:"tw-border-t-8 tw-mt-8 tw-pt-8"},{default:l(()=>[e(n,{cols:"12",sm:"6"},{default:l(()=>[we]),_:1}),e(n,{cols:"12",sm:"3"},{default:l(()=>[r("div",ke,[e(p,null,{default:l(({isHovering:a,props:c})=>[e(y,_(c,{color:a?"accent":"primary",dark:""}),{default:l(()=>[m(" Benutzer verbinden "),e(j,{modelValue:Z.value,"onUpdate:modelValue":t[3]||(t[3]=o=>Z.value=o),activator:"parent",width:"80vw"},{default:l(()=>[e($,{height:"80vh"},{default:l(()=>[e(P,null,{default:l(()=>[Ve]),_:1}),e(N,null,{default:l(()=>[e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[ye]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[e(M,{modelValue:u(b).users,"onUpdate:modelValue":t[2]||(t[2]=o=>u(b).users=o),items:U.users,"error-messages":f.value.users,"item-title":"full_name","item-value":"id",label:"User",multiple:"",required:""},null,8,["modelValue","items","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),e(T,null,{default:l(()=>[e(p,null,{default:l(({isHovering:o,props:h})=>[e(x,_({onClick:q},h,{color:o?"primary":"accent"}),{default:l(()=>[m("Zurücksetzen")]),_:2},1040,["color"])]),_:2},1024),e(A),e(p,null,{default:l(({isHovering:o,props:h})=>[e(y,_({onClick:w},h,{color:o?"accent":"primary"}),{default:l(()=>[m("Zurück")]),_:2},1040,["color"])]),_:2},1024),e(p,null,{default:l(({isHovering:o,props:h})=>[e(x,_({onClick:le},h,{color:o?"accent":"primary"}),{default:l(()=>[m("Speichern")]),_:2},1040,["color"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1040,["color"])]),_:1})])]),_:1}),e(n,{cols:"12",sm:"3"},{default:l(()=>[r("div",ze,[e(p,null,{default:l(({isHovering:a,props:c})=>[e(y,_(c,{color:a?"accent":"primary",dark:""}),{default:l(()=>[m(" Benutzer hinzufügen "),e(j,{modelValue:B.value,"onUpdate:modelValue":t[9]||(t[9]=o=>B.value=o),activator:"parent",width:"80vw"},{default:l(()=>[e($,{height:"80vh"},{default:l(()=>[e(P,null,{default:l(()=>[xe]),_:1}),e(N,null,{default:l(()=>[e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12",sm:"6"},{default:l(()=>[e(C,{modelValue:u(i).first_name,"onUpdate:modelValue":t[4]||(t[4]=o=>u(i).first_name=o),"error-messages":f.value.first_name,label:"Vorname",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:l(()=>[e(C,{modelValue:u(i).last_name,"onUpdate:modelValue":t[5]||(t[5]=o=>u(i).last_name=o),"error-messages":f.value.last_name,label:"Nachname",required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(n,{cols:"12",sm:"6"},{default:l(()=>[e(C,{modelValue:u(i).email,"onUpdate:modelValue":t[6]||(t[6]=o=>u(i).email=o),"error-messages":f.value.email,label:"Email",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:l(()=>[e(M,{modelValue:u(i).role,"onUpdate:modelValue":t[7]||(t[7]=o=>u(i).role=o),items:U.roles,"error-messages":f.value.role,"item-title":"human_name","item-value":"id",label:"Role",required:""},null,8,["modelValue","items","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(n,{cols:"12",md:"4",sm:"6"},{default:l(()=>[e(te,{modelValue:u(i).two_factor_auth_enabled,"onUpdate:modelValue":t[8]||(t[8]=o=>u(i).two_factor_auth_enabled=o),label:"Zwei-Faktor-Authentifizierung",value:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(T,null,{default:l(()=>[e(p,null,{default:l(({isHovering:o,props:h})=>[e(x,_({onClick:q},h,{color:o?"primary":"accent"}),{default:l(()=>[m("Zurücksetzen")]),_:2},1040,["color"])]),_:2},1024),e(A),e(p,null,{default:l(({isHovering:o,props:h})=>[e(y,_({onClick:w},h,{color:o?"accent":"primary"}),{default:l(()=>[m("Zurück")]),_:2},1040,["color"])]),_:2},1024),e(p,null,{default:l(({isHovering:o,props:h})=>[e(x,_({onClick:ee},h,{color:o?"accent":"primary"}),{default:l(()=>[m("Speichern")]),_:2},1040,["color"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1040,["color"])]),_:1})])]),_:1})]),_:1})]),_:1}),e(V,null,{default:l(()=>[e(j,{modelValue:E.value,"onUpdate:modelValue":t[10]||(t[10]=a=>E.value=a),width:"20vw"},{default:l(()=>[e($,{height:"30vh"},{default:l(()=>[e(N,null,{default:l(()=>[e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[r("p",null,"Sind Sie sicher, dass Sie den Benutzer "+K(O.value)+" aus Kita Liste löschen möchten? (Der Benutzer wird vom aktuellen Kita getrennt)",1)]),_:1})]),_:1})]),_:1})]),_:1}),e(T,null,{default:l(()=>[e(A),e(p,null,{default:l(({isHovering:a,props:c})=>[e(y,_({onClick:w},c,{color:a?"accent":"primary"}),{default:l(()=>[m("Abbrechen")]),_:2},1040,["color"])]),_:1}),e(p,null,{default:l(({isHovering:a,props:c})=>[e(x,_({onClick:X},c,{color:a?"accent":"primary"}),{default:l(()=>[m("Löschen")]),_:2},1040,["color"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[_e((R(),fe(ae,{"items-per-page":-1,headers:H,items:J.value,loading:G.value,class:"data-table-container data-table-container-hide-footer elevation-1","item-value":"name"},{item:l(({item:a})=>[r("tr",{"data-id":a.selectable.id,"data-order":a.selectable.order},[r("td",Ce,[e(I,{size:"medium",class:pe({active:a.selectable.is_online})},{default:l(()=>[m("mdi-circle")]),_:2},1032,["class"])]),r("td",null,K(a.selectable.first_name),1),r("td",null,K(a.selectable.last_name),1),r("td",null,K(a.selectable.email),1),r("td",null,K(a.selectable.primary_role_human_name),1),r("td",Ke,[e(L,{location:"top"},{activator:l(({props:c})=>[e(u(W),{href:`${s.route("users.edit",{id:a.selectable.id})}?from=kitas.show;${U.kita.id}`},{default:l(()=>[e(I,_(c,{size:"small",class:"tw-me-2"}),{default:l(()=>[m("mdi-pencil")]),_:2},1040)]),_:2},1032,["href"])]),default:l(()=>[Se]),_:2},1024),e(L,{location:"top"},{activator:l(({props:c})=>[e(I,_(c,{size:"small",class:"tw-me-2",onClick:o=>Q(a.raw)}),{default:l(()=>[m("mdi-delete ")]),_:2},1040,["onClick"])]),default:l(()=>[Be]),_:2},1024)])],8,Ue)]),"no-data":l(()=>[Ee]),_:1},8,["items","loading"])),[[oe]])]),_:1})]),_:1})]),_:1})])]),_:1},8,["errors"])],64)}}};export{Ae as default};
