import{d as re}from"./index-1a123876.js";import{K as ue,k as w,h as ie,m as de,T as D,r as u,n as ce,o as P,f as me,a as e,u as i,w as l,F as _e,Z as fe,b as r,p as _,d as m,i as R,c as W,g as pe,t as K,q as ve,s as ge}from"./app-4d4768d8.js";import{_ as he}from"./AuthenticatedLayout-9236d9be.js";import"./sortable.esm-0d19b1d3.js";import"./ApplicationLogo-7f08fd77.js";const ke=r("h2",{class:"tw-font-semibold tw-text-xl tw-text-gray-800 tw-leading-tight"},"Verwalte Kita",-1),be={class:"tw-table-block tw-max-w-full tw-mx-auto tw-py-6 tw-px-4 sm:tw-px-6 lg:tw-px-8"},we=r("h3",null,"Eigenschaften",-1),Ve=r("h3",null,"Zugeordnete Benutzer",-1),ye={class:"tw-flex tw-items-center tw-justify-end"},ze=r("span",{class:"tw-text-h5"},"Verbinden Benutzer",-1),Ce=r("p",null,"Wählen Sie die Benutzer aus, die Sie diesem Kita hinzufügen möchten",-1),Ue=r("span",{class:"tw-text-h5"},"Neue Benutzer",-1),xe=["data-id","data-order"],Ke={align:"center"},Se={align:"center"},Be=r("span",null,"Benutzer bearbeiten",-1),Ee=r("span",null,"Benutzer löschen",-1),Fe=r("div",{class:"tw-py-6"},[r("h3",{class:"tw-mb-4"},"Die Tabelle ist leer.")],-1),Ae={__name:"ManageKita",props:{kita:Object,errors:Object,roles:Array,users:Array},setup(U){const S=U;re.Inertia.on("success",s=>{let t=s.detail.page.props;s.detail.page.component==="Kita/Partials/ManageKita"&&t&&(z.value=t.kita)}),ue().props.auth.user;const z=w(S.kita),f=w(S.errors||{}),G=w(!1);w(null);const j=w(null),B=w(!1),N=w(!1),E=w(!1),H=[{title:"Status",key:"is_online",width:"5%",sortable:!1,align:"center"},{title:"Vorname",key:"first_name",width:"20%",sortable:!1},{title:"Nachname",key:"last_name",width:"25%",sortable:!1},{title:"E-Mail",key:"email",width:"20%",sortable:!1},{title:"Rolle",key:"primary_role_name",width:"20%",sortable:!1},{title:"Aktion",key:"actions",width:"10%",sortable:!1,align:"center"}],J=ie(()=>S.kita.users.map(s=>{const t={...s};for(const n in t)(t[n]===null||t[n]===void 0)&&(t[n]="-");return t}));de(B,s=>{s||b()});const b=()=>{B.value=!1,N.value=!1,E.value=!1,d.reset(),d.clearErrors(),k.reset(),k.clearErrors(),f.value={}},Z=()=>{d.reset(),d.clearErrors(),k.reset(),k.clearErrors(),v.reset(),v.clearErrors(),v.zip_code=!1,v.name=null},Q=s=>{j.value=s.full_name,F.user=s.id,E.value=!0},F=D({user:null}),X=async()=>{F.processing=!0;let s={onSuccess:t=>{b()},onError:t=>{f.value=t},onFinish:()=>{F.processing=!1}};F.post(route("kitas.disconnect_user",{id:S.kita.id}),s)},v=D({id:z.value.id,name:z.value.name,zip_code:z.value.zip_code}),Y=async()=>{v.processing=!0;let s={preserveState:!1,onSuccess:t=>{b()},onError:t=>{f.value=t},onFinish:()=>{v.processing=!1}};v.put(route("kitas.update",{kita:v.id}),s)},d=D({first_name:null,last_name:null,email:null,role:null,two_factor_auth_enabled:!1,kitas:[z.value.id]}),ee=async()=>{d.processing=!0,d.post(route("users.store_from_kita"),{onSuccess:s=>{b()},onError:s=>{f.value=s},onFinish:()=>{d.processing=!1}})},k=D({users:null,kitas:[z.value.id]}),le=async()=>{k.processing=!0,k.post(route("kitas.connect_users",{kita:d.kitas}),{onSuccess:s=>{b()},onError:s=>{f.value=s},onFinish:()=>{k.processing=!1}})};return(s,t)=>{const n=u("v-col"),g=u("v-row"),V=u("v-container"),x=u("v-text-field"),y=u("v-btn"),p=u("v-hover"),C=u("v-btn-primary"),M=u("v-card-title"),te=u("v-autocomplete"),q=u("v-card-text"),$=u("v-spacer"),A=u("v-card-actions"),T=u("v-card"),I=u("v-dialog"),ae=u("v-select"),oe=u("v-checkbox"),O=u("v-icon"),L=u("v-tooltip"),se=u("v-data-table-server"),ne=ce("sortable-data-table");return P(),me(_e,null,[e(i(fe),{title:`Verwalte Kita ${U.kita.name}`},null,8,["title"]),e(he,{errors:f.value},{header:l(()=>[ke]),default:l(()=>[r("div",be,[e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[we]),_:1})]),_:1})]),_:1}),e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12",sm:"9"},{default:l(()=>[e(x,{modelValue:i(v).name,"onUpdate:modelValue":t[0]||(t[0]=a=>i(v).name=a),"error-messages":f.value.name,label:"Name der Einrichtung / Kita*",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(n,{cols:"12",sm:"3"},{default:l(()=>[e(x,{modelValue:i(v).zip_code,"onUpdate:modelValue":t[1]||(t[1]=a=>i(v).zip_code=a),"error-messages":f.value.zip_code,label:"Postleitzahl*",type:"number",required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(n,{cols:"12",sm:"6"},{default:l(()=>[e(p,null,{default:l(({isHovering:a,props:c})=>[e(y,_({onClick:Z},c,{color:a?"primary":"accent"}),{default:l(()=>[m("Zurücksetzen")]),_:2},1040,["color"])]),_:1})]),_:1}),e(n,{cols:"12",sm:"6",align:"right"},{default:l(()=>[e(p,null,{default:l(({isHovering:a,props:c})=>[e(i(R),{href:s.route("kitas.index")},{default:l(()=>[e(y,_({class:"mr-2",variant:"text"},c,{color:a?"accent":"primary"}),{default:l(()=>[m("Zurück")]),_:2},1040,["color"])]),_:2},1032,["href"])]),_:1}),e(p,null,{default:l(({isHovering:a,props:c})=>[e(C,_({onClick:Y},c,{color:a?"accent":"primary"}),{default:l(()=>[m("Speichern ")]),_:2},1040,["color"])]),_:1})]),_:1})]),_:1})]),_:1}),e(V,null,{default:l(()=>[e(g,{class:"tw-border-t-8 tw-mt-8 tw-pt-8"},{default:l(()=>[e(n,{cols:"12",sm:"6"},{default:l(()=>[Ve]),_:1}),e(n,{cols:"12",sm:"6"},{default:l(()=>[r("div",ye,[s.$page.props.auth.user.is_super_admin||s.$page.props.auth.user.is_admin?(P(),W(p,{key:0},{default:l(({isHovering:a,props:c})=>[e(y,_(c,{color:a?"accent":"primary",dark:"",class:"mr-2"}),{default:l(()=>[m(" Benutzer verbinden "),e(I,{modelValue:N.value,"onUpdate:modelValue":t[3]||(t[3]=o=>N.value=o),activator:"parent",width:"80vw"},{default:l(()=>[e(T,{height:"80vh"},{default:l(()=>[e(M,null,{default:l(()=>[ze]),_:1}),e(q,null,{default:l(()=>[e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[Ce]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[e(te,{modelValue:i(k).users,"onUpdate:modelValue":t[2]||(t[2]=o=>i(k).users=o),items:U.users,"error-messages":f.value.users,"item-title":"full_name","item-value":"id",label:"User",multiple:"",required:""},null,8,["modelValue","items","error-messages"])]),_:1})]),_:1})]),_:1})]),_:1}),e(A,null,{default:l(()=>[e(p,null,{default:l(({isHovering:o,props:h})=>[e(C,_({onClick:Z},h,{color:o?"primary":"accent"}),{default:l(()=>[m("Zurücksetzen")]),_:2},1040,["color"])]),_:2},1024),e($),e(p,null,{default:l(({isHovering:o,props:h})=>[e(y,_({onClick:b},h,{color:o?"accent":"primary"}),{default:l(()=>[m("Zurück")]),_:2},1040,["color"])]),_:2},1024),e(p,null,{default:l(({isHovering:o,props:h})=>[e(C,_({onClick:le},h,{color:o?"accent":"primary"}),{default:l(()=>[m("Speichern")]),_:2},1040,["color"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1040,["color"])]),_:1})):pe("",!0),e(p,null,{default:l(({isHovering:a,props:c})=>[e(y,_(c,{color:a?"accent":"primary",dark:""}),{default:l(()=>[m(" Benutzer hinzufügen "),e(I,{modelValue:B.value,"onUpdate:modelValue":t[9]||(t[9]=o=>B.value=o),activator:"parent",width:"80vw"},{default:l(()=>[e(T,{height:"80vh"},{default:l(()=>[e(M,null,{default:l(()=>[Ue]),_:1}),e(q,null,{default:l(()=>[e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12",sm:"6"},{default:l(()=>[e(x,{modelValue:i(d).first_name,"onUpdate:modelValue":t[4]||(t[4]=o=>i(d).first_name=o),"error-messages":f.value.first_name,label:"Vorname",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:l(()=>[e(x,{modelValue:i(d).last_name,"onUpdate:modelValue":t[5]||(t[5]=o=>i(d).last_name=o),"error-messages":f.value.last_name,label:"Nachname",required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(n,{cols:"12",sm:"6"},{default:l(()=>[e(x,{modelValue:i(d).email,"onUpdate:modelValue":t[6]||(t[6]=o=>i(d).email=o),"error-messages":f.value.email,label:"Email",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(n,{cols:"12",sm:"6"},{default:l(()=>[e(ae,{modelValue:i(d).role,"onUpdate:modelValue":t[7]||(t[7]=o=>i(d).role=o),items:U.roles,"error-messages":f.value.role,"item-title":"human_name","item-value":"id",label:"Role",required:""},null,8,["modelValue","items","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(n,{cols:"12",md:"4",sm:"6"},{default:l(()=>[e(oe,{modelValue:i(d).two_factor_auth_enabled,"onUpdate:modelValue":t[8]||(t[8]=o=>i(d).two_factor_auth_enabled=o),label:"Zwei-Faktor-Authentifizierung",value:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(A,null,{default:l(()=>[e(p,null,{default:l(({isHovering:o,props:h})=>[e(C,_({onClick:Z},h,{color:o?"primary":"accent"}),{default:l(()=>[m("Zurücksetzen")]),_:2},1040,["color"])]),_:2},1024),e($),e(p,null,{default:l(({isHovering:o,props:h})=>[e(y,_({onClick:b},h,{color:o?"accent":"primary"}),{default:l(()=>[m("Zurück")]),_:2},1040,["color"])]),_:2},1024),e(p,null,{default:l(({isHovering:o,props:h})=>[e(C,_({onClick:ee},h,{color:o?"accent":"primary"}),{default:l(()=>[m("Speichern")]),_:2},1040,["color"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1040,["color"])]),_:1})])]),_:1})]),_:1})]),_:1}),e(V,null,{default:l(()=>[e(I,{modelValue:E.value,"onUpdate:modelValue":t[10]||(t[10]=a=>E.value=a),width:"20vw"},{default:l(()=>[e(T,{height:"30vh"},{default:l(()=>[e(q,null,{default:l(()=>[e(V,null,{default:l(()=>[e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[r("p",null,"Sind Sie sicher, dass Sie den Benutzer "+K(j.value)+" aus Kita Liste löschen möchten? (Der Benutzer wird vom aktuellen Kita getrennt)",1)]),_:1})]),_:1})]),_:1})]),_:1}),e(A,null,{default:l(()=>[e($),e(p,null,{default:l(({isHovering:a,props:c})=>[e(y,_({onClick:b},c,{color:a?"accent":"primary"}),{default:l(()=>[m("Abbrechen")]),_:2},1040,["color"])]),_:1}),e(p,null,{default:l(({isHovering:a,props:c})=>[e(C,_({onClick:X},c,{color:a?"accent":"primary"}),{default:l(()=>[m("Löschen")]),_:2},1040,["color"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(g,null,{default:l(()=>[e(n,{cols:"12"},{default:l(()=>[ve((P(),W(se,{"items-per-page":-1,headers:H,items:J.value,loading:G.value,class:"data-table-container data-table-container-hide-footer elevation-1","item-value":"name"},{item:l(({item:a})=>[r("tr",{"data-id":a.selectable.id,"data-order":a.selectable.order},[r("td",Ke,[e(O,{size:"medium",class:ge({active:a.selectable.is_online})},{default:l(()=>[m("mdi-circle")]),_:2},1032,["class"])]),r("td",null,K(a.selectable.first_name),1),r("td",null,K(a.selectable.last_name),1),r("td",null,K(a.selectable.email),1),r("td",null,K(a.selectable.primary_role_human_name),1),r("td",Se,[e(L,{location:"top"},{activator:l(({props:c})=>[e(i(R),{href:`${s.route("users.edit",{id:a.selectable.id})}?from=kitas.show;${U.kita.id}`},{default:l(()=>[e(O,_(c,{size:"small",class:"tw-me-2"}),{default:l(()=>[m("mdi-pencil")]),_:2},1040)]),_:2},1032,["href"])]),default:l(()=>[Be]),_:2},1024),e(L,{location:"top"},{activator:l(({props:c})=>[e(O,_(c,{size:"small",class:"tw-me-2",onClick:o=>Q(a.raw)}),{default:l(()=>[m("mdi-delete ")]),_:2},1040,["onClick"])]),default:l(()=>[Ee]),_:2},1024)])],8,xe)]),"no-data":l(()=>[Fe]),_:1},8,["items","loading"])),[[ne]])]),_:1})]),_:1})]),_:1})])]),_:1},8,["errors"])],64)}}};export{Ae as default};
