import{d as fe}from"./index-3fefaf12.js";import{K as ge,k as c,h as j,m as T,A as ee,T as le,r as u,f as q,a as e,u as d,w as l,F as te,o as B,Z as be,b as n,p as V,d as b,y as he,t as N,c as ae,i as we,g as se,O as ye}from"./app-3abe3d3d.js";import{f as Ve,c as ke}from"./common-1f9d3448.js";import{_ as Pe}from"./AuthenticatedLayout-16e5494c.js";import"./ApplicationLogo-7e725a99.js";const Ue=n("h2",{class:"tw-font-semibold tw-text-xl tw-text-gray-800 tw-leading-tight"},"Benutzer",-1),Se={class:"tw-flex tw-items-center tw-justify-end"},ze=n("span",{class:"tw-text-h5"},"Neuen Benutzer",-1),Be=n("p",null,"Sind Sie sicher, dass Sie den aktuellen Benutzer löschen möchten?",-1),Ne={class:"tw-table-block tw-max-w-full tw-mx-auto tw-py-6 tw-px-4 sm:tw-px-6 lg:tw-px-8"},xe={class:"tw-bg-white tw-flex tw-justify-between tw-px-6 tw-py-6"},Ce={class:"tw-w-full"},Ee={align:"center"},Fe=n("span",null,"Benutzer bearbeiten",-1),Te=n("span",null,"Benutzer löschen",-1),$e={class:"tw-py-6"},De={key:0,class:"tw-mb-4"},Ae=n("h3",{class:"tw-mb-4"},"Die Tabelle ist leer. Bitte setzen Sie die Suchfilter zurück.",-1),Re={__name:"Users",props:{items:Array,currentPage:Number,perPage:Number,lastPage:Number,total:Number,paging:Boolean,orderBy:String,sort:String,filters:Object,errors:Object,roles:Array},setup($){const _=$;fe.Inertia.on("success",s=>{let t=s.detail.page.props;s.detail.page.component==="Users/Users"&&t&&(x.value=t.currentPage,U.value=t.perPage,oe.value=t.orderBy,ne.value=t.sort,I.value=t.total,re.value=t.lastPage)}),ge().props.auth.user;const x=c(_.currentPage),U=c(_.perPage),oe=c(_.orderBy),ne=c(_.sort),I=c(_.total),re=c(_.lastPage),h=c(_.filters.full_name??null),w=c(_.filters.email??null),y=c(_.filters.roles??null),L=c(""),v=c(_.errors||{}),k=c(!1),C=c(!1),E=c(!1),ue=[{title:"Status",key:"is_online",width:"5%",sortable:!1,align:"center"},{title:"Name",key:"first_name",width:"25%",sortable:!0},{title:"Email",key:"email",width:"20%",sortable:!0},{title:"Rolle",key:"primary_role_name",width:"10%",sortable:!0},{title:"Letzter Login",key:"last_seen_at",width:"15%",sortable:!0},{title:"Erster Login",key:"first_login_at",width:"15%",sortable:!0},{title:"Aktionen",key:"actions",width:"10%",sortable:!1}],ie=j(()=>_.items.map(s=>{const t={...s};for(const p in t)(t[p]===null||t[p]===void 0)&&(t[p]="-");return t})),R=j(()=>h.value===null&&w.value===null&&y.value===null),de=j(()=>h.value!==null||w.value!==null||y.value!==null);T(C,s=>{s||S()}),T(h,ee.debounce(s=>{D()},500)),T(w,ee.debounce(s=>{D()},500)),T(y,s=>{D()});const D=()=>{k.value=!0,L.value=String(Date.now())},Z=async({page:s,itemsPerPage:t,sortBy:p,clearFilters:f})=>{if(f&&(h.value=null,w.value=null,y.value=null),s===x.value&&f||R||de){k.value=!0;let o={page:s,per_page:t};p&&p.length>0?(o.order_by=p[0].key,o.sort=p[0].order):(o.order_by=null,o.sort=null),h.value&&(o.full_name=h.value),w.value&&(o.email=w.value),y.value&&(o.with_roles=y.value),await ye.get(route(route().current()),o,{preserveScroll:!0,preserveState:!0,onCancelToken:m=>{},onCancel:()=>{},onBefore:m=>{k.value=!0},onStart:m=>{},onProgress:m=>{},onSuccess:m=>{x.value=o.page,U.value=o.per_page},onError:m=>{console.log(m)},onFinish:m=>{k.value=!1}})}},ce=s=>{P.id=s.id,E.value=!0},P=le({id:null}),me=async()=>{P.processing=!0;let s={onSuccess:t=>{S()},onError:t=>{v.value=t},onFinish:()=>{P.processing=!1}};P.delete(route("users.destroy",{id:P.id}),s)},S=()=>{C.value=!1,E.value=!1,P.id=null,i.reset(),i.clearErrors(),v.value={}},i=le({first_name:null,last_name:null,email:null,role:null,two_factor_auth_enabled:!1,phone_number:null}),_e=async()=>{i.processing=!0;let s={onSuccess:t=>{S()},onError:t=>{v.value=t},onFinish:()=>{i.processing=!1}};i.post(route("users.store"),s)};return(s,t)=>{const p=u("v-card-title"),f=u("v-text-field"),o=u("v-col"),m=u("v-row"),K=u("v-select"),pe=u("v-checkbox"),G=u("v-container"),H=u("v-card-text"),J=u("v-spacer"),F=u("v-btn"),z=u("v-hover"),M=u("v-btn-primary"),Q=u("v-card-actions"),W=u("v-card"),X=u("v-dialog"),A=u("v-icon"),Y=u("v-tooltip"),ve=u("v-data-table-server");return B(),q(te,null,[e(d(be),{title:"Benutzer"}),e(Pe,{errors:v.value},{header:l(()=>[Ue,n("div",Se,[e(z,null,{default:l(({isHovering:a,props:g})=>[e(F,V(g,{color:a?"accent":"primary",dark:""}),{default:l(()=>[b(" Neuen Benutzer hinzufügen "),e(X,{modelValue:C.value,"onUpdate:modelValue":t[6]||(t[6]=r=>C.value=r),activator:"parent",width:"80vw"},{default:l(()=>[e(W,{height:"80vh"},{default:l(()=>[e(p,null,{default:l(()=>[ze]),_:1}),e(H,null,{default:l(()=>[e(G,null,{default:l(()=>[e(m,null,{default:l(()=>[e(o,{cols:"12",sm:"6"},{default:l(()=>[e(f,{modelValue:d(i).first_name,"onUpdate:modelValue":t[0]||(t[0]=r=>d(i).first_name=r),"error-messages":v.value.first_name,label:"Vorname",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",sm:"6"},{default:l(()=>[e(f,{modelValue:d(i).last_name,"onUpdate:modelValue":t[1]||(t[1]=r=>d(i).last_name=r),"error-messages":v.value.last_name,label:"Nachname",required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(m,null,{default:l(()=>[e(o,{cols:"12",sm:"6"},{default:l(()=>[e(f,{modelValue:d(i).email,"onUpdate:modelValue":t[2]||(t[2]=r=>d(i).email=r),"error-messages":v.value.email,label:"Email",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",sm:"6"},{default:l(()=>[e(f,{modelValue:d(i).phone_number,"onUpdate:modelValue":t[3]||(t[3]=r=>d(i).phone_number=r),"error-messages":v.value.phone_number,label:"Telefonnummer"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(m,null,{default:l(()=>[e(o,{cols:"12",sm:"6"},{default:l(()=>[e(K,{modelValue:d(i).role,"onUpdate:modelValue":t[4]||(t[4]=r=>d(i).role=r),items:$.roles,"error-messages":v.value.role,"item-title":"human_name","item-value":"id",label:"Role",required:""},null,8,["modelValue","items","error-messages"])]),_:1}),e(o,{cols:"12",md:"4",sm:"6"},{default:l(()=>[e(pe,{modelValue:d(i).two_factor_auth_enabled,"onUpdate:modelValue":t[5]||(t[5]=r=>d(i).two_factor_auth_enabled=r),label:"Zwei-Faktor-Authentifizierung",value:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(Q,null,{default:l(()=>[e(J),e(z,null,{default:l(({isHovering:r,props:O})=>[e(F,V({onClick:S},O,{color:r?"accent":"primary"}),{default:l(()=>[b("Abbrechen")]),_:2},1040,["color"])]),_:2},1024),e(z,null,{default:l(({isHovering:r,props:O})=>[e(M,V({onClick:_e},O,{color:r?"accent":"primary"}),{default:l(()=>[b("Speichern")]),_:2},1040,["color"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1040,["color"])]),_:1})]),e(X,{modelValue:E.value,"onUpdate:modelValue":t[7]||(t[7]=a=>E.value=a),width:"20vw"},{default:l(()=>[e(W,{height:"30vh"},{default:l(()=>[e(H,null,{default:l(()=>[e(G,null,{default:l(()=>[e(m,null,{default:l(()=>[e(o,{cols:"12"},{default:l(()=>[Be]),_:1})]),_:1})]),_:1})]),_:1}),e(Q,null,{default:l(()=>[e(J),e(z,null,{default:l(({isHovering:a,props:g})=>[e(F,V({onClick:S},g,{color:a?"accent":"primary"}),{default:l(()=>[b("Abbrechen")]),_:2},1040,["color"])]),_:1}),e(z,null,{default:l(({isHovering:a,props:g})=>[e(M,V({onClick:me},g,{color:a?"accent":"primary"}),{default:l(()=>[b("Löschen")]),_:2},1040,["color"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),default:l(()=>[n("div",Ne,[n("div",xe,[n("div",Ce,[e(m,null,{default:l(()=>[e(o,{cols:"12",sm:"4"},{default:l(()=>[e(f,{modelValue:h.value,"onUpdate:modelValue":t[8]||(t[8]=a=>h.value=a),label:"Name",clearable:""},null,8,["modelValue"])]),_:1}),e(o,{cols:"12",sm:"4"},{default:l(()=>[e(f,{modelValue:w.value,"onUpdate:modelValue":t[9]||(t[9]=a=>w.value=a),label:"Email",clearable:""},null,8,["modelValue"])]),_:1}),e(o,{cols:"12",sm:"4"},{default:l(()=>[e(K,{modelValue:y.value,"onUpdate:modelValue":t[10]||(t[10]=a=>y.value=a),items:$.roles,"item-title":"human_name","item-value":"name",label:"Rolle",multiple:"",disabled:k.value,clearable:""},null,8,["modelValue","items","disabled"])]),_:1})]),_:1})])]),e(ve,{"items-per-page":U.value,"onUpdate:itemsPerPage":t[12]||(t[12]=a=>U.value=a),headers:ue,page:x.value,"items-length":I.value,items:ie.value,search:L.value,loading:k.value,class:"data-table-container elevation-1","item-value":"name","onUpdate:options":Z},{item:l(({item:a})=>[n("tr",null,[n("td",Ee,[e(A,{size:"medium",class:he({active:a.selectable.is_online})},{default:l(()=>[b("mdi-circle")]),_:2},1032,["class"])]),n("td",null,N(a.selectable.full_name),1),n("td",null,N(a.selectable.email),1),n("td",null,N(a.selectable.primary_role_human_name),1),n("td",null,N(!a.selectable.last_seen_at||a.selectable.last_seen_at==="-"?a.selectable.last_seen_at:d(Ve)(a.selectable.last_seen_at,"sv-SE")),1),n("td",null,N(!a.selectable.first_login_at||a.selectable.first_login_at==="-"?a.selectable.first_login_at:d(ke)(a.selectable.first_login_at,"fr-CA")),1),n("td",null,[s.$page.props.auth.user.is_super_admin||(s.$page.props.auth.user.is_admin||s.$page.props.auth.user.is_manager)&&!a.selectable.is_super_admin&&!a.selectable.is_admin||s.$page.props.auth.user.is_admin&&s.$page.props.auth.user.id===a.selectable.id?(B(),ae(Y,{key:0,location:"top"},{activator:l(({props:g})=>[e(d(we),{href:s.route("users.edit",{id:a.selectable.id})},{default:l(()=>[e(A,V(g,{size:"small",class:"tw-me-2"}),{default:l(()=>[b("mdi-pencil")]),_:2},1040)]),_:2},1032,["href"])]),default:l(()=>[Fe]),_:2},1024)):se("",!0),s.$page.props.auth.user.is_super_admin||s.$page.props.auth.user.is_admin||s.$page.props.auth.user.is_manager&&!a.selectable.is_super_admin&&!a.selectable.is_admin?(B(),ae(Y,{key:1,location:"top"},{activator:l(({props:g})=>[e(A,V(g,{size:"small",class:"tw-me-2",onClick:r=>ce(a.raw)}),{default:l(()=>[b("mdi-delete")]),_:2},1040,["onClick"])]),default:l(()=>[Te]),_:2},1024)):se("",!0)])])]),"no-data":l(()=>[n("div",$e,[R.value?(B(),q("h3",De,"Die Tabelle ist leer.")):(B(),q(te,{key:1},[Ae,e(F,{color:"primary",onClick:t[11]||(t[11]=a=>Z({page:1,itemsPerPage:U.value,clearFilters:!0}))},{default:l(()=>[b("Zurücksetzen")]),_:1})],64))])]),_:1},8,["items-per-page","page","items-length","items","search","loading"])])]),_:1},8,["errors"])],64)}}};export{Re as default};
