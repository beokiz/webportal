import{d as ze}from"./index-035529e4.js";import{K as Ne,k as n,h as J,m as P,A as de,T as me,r,f as K,a as e,u as m,w as t,F as ce,o as C,Z as Be,b as u,p as V,d as h,y as xe,t as E,c as ve,i as Ae,g as _e,O as Ce}from"./app-cc71f302.js";import{b as pe,f as Ee,c as Le}from"./common-1f9d3448.js";import{_ as $e}from"./AuthenticatedLayout-ebf251b0.js";import"./ApplicationLogo-c10514e0.js";const Te=u("h2",{class:"tw-font-semibold tw-text-xl tw-text-gray-800 tw-leading-tight"},"Benutzer",-1),De={class:"tw-flex tw-items-center tw-justify-end"},Oe=u("span",{class:"tw-text-h5"},"Neuen Benutzer",-1),je=u("p",null,"Sind Sie sicher, dass Sie den aktuellen Benutzer löschen möchten?",-1),qe={class:"tw-table-block tw-max-w-full tw-mx-auto tw-py-6 tw-px-4 sm:tw-px-6 lg:tw-px-8"},Ie={class:"tw-bg-white tw-flex tw-justify-between tw-px-6 tw-py-6"},Re={class:"tw-w-full"},Ze={align:"center"},Je=u("span",null,"Benutzer bearbeiten",-1),Ke=u("span",null,"Benutzer löschen",-1),Ge={class:"tw-py-6"},He={key:0,class:"tw-mb-4"},Me=u("h3",{class:"tw-mb-4"},"Die Tabelle ist leer. Bitte setzen Sie die Suchfilter zurück.",-1),ll={__name:"Users",props:{items:Array,currentPage:Number,perPage:Number,lastPage:Number,total:Number,paging:Boolean,orderBy:String,sort:String,filters:Object,errors:Object,roles:Array},setup(O){const v=O;ze.Inertia.on("success",o=>{let l=o.detail.page.props;o.detail.page.component==="Users/Users"&&l&&(L.value=l.currentPage,B.value=l.perPage,fe.value=l.orderBy,ge.value=l.sort,G.value=l.total,be.value=l.lastPage)}),Ne().props.auth.user;const L=n(v.currentPage),B=n(v.perPage),fe=n(v.orderBy),ge=n(v.sort),G=n(v.total),be=n(v.lastPage),y=n(v.filters.status??null),k=n(v.filters.full_name??null),S=n(v.filters.email??null),U=n(null),H=n(""),f=n(v.errors||{}),j=n(!1),q=n(!1),F=n(!1),$=n(!1),T=n(!1),M=n(null),Q=n(null),g=n(null),b=n(null),we=[{title:"Status",key:"is_online",width:"5%",sortable:!1,align:"center"},{title:"Name",key:"first_name",width:"25%",sortable:!0},{title:"Email",key:"email",width:"20%",sortable:!0},{title:"Rolle",key:"primary_role_name",width:"10%",sortable:!0},{title:"Letzter Login",key:"last_seen_at",width:"15%",sortable:!0},{title:"Erster Login",key:"first_login_at",width:"15%",sortable:!0},{title:"Aktionen",key:"actions",width:"10%",sortable:!1}],Ve=[{title:"Ja",value:"true"},{title:"Nein",value:"false"}],he=J(()=>v.items.map(o=>{const l={...o};for(const _ in l)(l[_]===null||l[_]===void 0)&&(l[_]="-");return l})),W=J(()=>y.value===null&&k.value===null&&S.value===null&&U.value===null&&g.value===null&&b.value===null),ye=J(()=>y.value!==null||k.value!==null||S.value!==null||U.value!==null||g.value!==null||b.value!==null);P($,o=>{o||x()}),P(y,o=>{z()}),P(k,de.debounce(o=>{z()},500)),P(S,de.debounce(o=>{z()},500)),P(U,o=>{z()}),P(g,o=>{M.value=o?pe(o):null,z()}),P(b,o=>{Q.value=o?pe(o):null,z()});const z=()=>{F.value=!0,H.value=String(Date.now())},X=async({page:o,itemsPerPage:l,sortBy:_,clearFilters:p})=>{if(p&&(y.value=null,k.value=null,S.value=null,U.value=null,g.value=null,b.value=null),o===L.value&&p||W||ye){F.value=!0;let s={page:o,per_page:l};_&&_.length>0?(s.order_by=_[0].key,s.sort=_[0].order):(s.order_by=null,s.sort=null),y.value&&(s.status=y.value),k.value&&(s.full_name=k.value),S.value&&(s.email=S.value),U.value&&(s.with_roles=U.value),g.value&&(s.first_login_at=g.value.toLocaleString()),b.value&&(s.last_seen_at=b.value.toLocaleString()),await Ce.get(route(route().current()),s,{preserveScroll:!0,preserveState:!0,onCancelToken:c=>{},onCancel:()=>{},onBefore:c=>{F.value=!0},onStart:c=>{},onProgress:c=>{},onSuccess:c=>{L.value=s.page,B.value=s.per_page},onError:c=>{console.log(c)},onFinish:c=>{F.value=!1}})}},ke=o=>{N.id=o.id,T.value=!0},N=me({id:null}),Se=async()=>{N.processing=!0;let o={onSuccess:l=>{x()},onError:l=>{f.value=l},onFinish:()=>{N.processing=!1}};N.delete(route("users.destroy",{id:N.id}),o)},x=()=>{$.value=!1,T.value=!1,N.id=null,d.reset(),d.clearErrors(),f.value={}},d=me({first_name:null,last_name:null,email:null,role:null,two_factor_auth_enabled:!1,phone_number:null}),Ue=async()=>{d.processing=!0;let o={onSuccess:l=>{x()},onError:l=>{f.value=l},onFinish:()=>{d.processing=!1}};d.post(route("users.store"),o)};return(o,l)=>{const _=r("v-card-title"),p=r("v-text-field"),s=r("v-col"),c=r("v-row"),I=r("v-select"),Fe=r("v-checkbox"),Y=r("v-container"),ee=r("v-card-text"),le=r("v-spacer"),D=r("v-btn"),A=r("v-hover"),te=r("v-btn-primary"),ae=r("v-card-actions"),oe=r("v-card"),se=r("v-dialog"),ne=r("v-date-picker"),re=r("v-menu"),ue=r("v-locale-provider"),R=r("v-icon"),ie=r("v-tooltip"),Pe=r("v-data-table-server");return C(),K(ce,null,[e(m(Be),{title:"Benutzer"}),e($e,{errors:f.value},{header:t(()=>[Te,u("div",De,[e(A,null,{default:t(({isHovering:a,props:w})=>[e(D,V(w,{color:a?"accent":"primary",dark:""}),{default:t(()=>[h(" Neuen Benutzer hinzufügen "),e(se,{modelValue:$.value,"onUpdate:modelValue":l[6]||(l[6]=i=>$.value=i),activator:"parent",width:"80vw"},{default:t(()=>[e(oe,{height:"80vh"},{default:t(()=>[e(_,null,{default:t(()=>[Oe]),_:1}),e(ee,null,{default:t(()=>[e(Y,null,{default:t(()=>[e(c,null,{default:t(()=>[e(s,{cols:"12",sm:"6"},{default:t(()=>[e(p,{modelValue:m(d).first_name,"onUpdate:modelValue":l[0]||(l[0]=i=>m(d).first_name=i),"error-messages":f.value.first_name,label:"Vorname",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12",sm:"6"},{default:t(()=>[e(p,{modelValue:m(d).last_name,"onUpdate:modelValue":l[1]||(l[1]=i=>m(d).last_name=i),"error-messages":f.value.last_name,label:"Nachname",required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(s,{cols:"12",sm:"6"},{default:t(()=>[e(p,{modelValue:m(d).email,"onUpdate:modelValue":l[2]||(l[2]=i=>m(d).email=i),"error-messages":f.value.email,label:"Email",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12",sm:"6"},{default:t(()=>[e(p,{modelValue:m(d).phone_number,"onUpdate:modelValue":l[3]||(l[3]=i=>m(d).phone_number=i),"error-messages":f.value.phone_number,label:"Telefonnummer"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(s,{cols:"12",sm:"6"},{default:t(()=>[e(I,{modelValue:m(d).role,"onUpdate:modelValue":l[4]||(l[4]=i=>m(d).role=i),items:O.roles,"error-messages":f.value.role,"item-title":"human_name","item-value":"id",label:"Role",required:""},null,8,["modelValue","items","error-messages"])]),_:1}),e(s,{cols:"12",md:"4",sm:"6"},{default:t(()=>[e(Fe,{modelValue:m(d).two_factor_auth_enabled,"onUpdate:modelValue":l[5]||(l[5]=i=>m(d).two_factor_auth_enabled=i),label:"Zwei-Faktor-Authentifizierung",value:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ae,null,{default:t(()=>[e(le),e(A,null,{default:t(({isHovering:i,props:Z})=>[e(D,V({onClick:x},Z,{color:i?"accent":"primary"}),{default:t(()=>[h("Abbrechen")]),_:2},1040,["color"])]),_:2},1024),e(A,null,{default:t(({isHovering:i,props:Z})=>[e(te,V({onClick:Ue},Z,{color:i?"accent":"primary"}),{default:t(()=>[h("Speichern")]),_:2},1040,["color"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1040,["color"])]),_:1})]),e(se,{modelValue:T.value,"onUpdate:modelValue":l[7]||(l[7]=a=>T.value=a),width:"20vw"},{default:t(()=>[e(oe,{height:"30vh"},{default:t(()=>[e(ee,null,{default:t(()=>[e(Y,null,{default:t(()=>[e(c,null,{default:t(()=>[e(s,{cols:"12"},{default:t(()=>[je]),_:1})]),_:1})]),_:1})]),_:1}),e(ae,null,{default:t(()=>[e(le),e(A,null,{default:t(({isHovering:a,props:w})=>[e(D,V({onClick:x},w,{color:a?"accent":"primary"}),{default:t(()=>[h("Abbrechen")]),_:2},1040,["color"])]),_:1}),e(A,null,{default:t(({isHovering:a,props:w})=>[e(te,V({onClick:Se},w,{color:a?"accent":"primary"}),{default:t(()=>[h("Löschen")]),_:2},1040,["color"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),default:t(()=>[u("div",qe,[u("div",Ie,[u("div",Re,[e(c,null,{default:t(()=>[e(s,{cols:"12",sm:"4"},{default:t(()=>[e(I,{modelValue:y.value,"onUpdate:modelValue":l[8]||(l[8]=a=>y.value=a),items:Ve,"item-title":"title","item-value":"value",label:"Status",multiple:"",disabled:F.value,clearable:""},null,8,["modelValue","disabled"])]),_:1}),e(s,{cols:"12",sm:"4"},{default:t(()=>[e(p,{modelValue:k.value,"onUpdate:modelValue":l[9]||(l[9]=a=>k.value=a),label:"Name",clearable:""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12",sm:"4"},{default:t(()=>[e(p,{modelValue:S.value,"onUpdate:modelValue":l[10]||(l[10]=a=>S.value=a),label:"Email",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(s,{cols:"12",sm:"4"},{default:t(()=>[e(I,{modelValue:U.value,"onUpdate:modelValue":l[11]||(l[11]=a=>U.value=a),items:O.roles,"item-title":"human_name","item-value":"name",label:"Rolle",multiple:"",disabled:F.value,clearable:""},null,8,["modelValue","items","disabled"])]),_:1}),e(s,{cols:"12",sm:"4"},{default:t(()=>[e(ue,{locale:"de"},{default:t(()=>[e(re,{modelValue:j.value,"onUpdate:modelValue":l[14]||(l[14]=a=>j.value=a),"return-value":g.value,"close-on-content-click":!1},{activator:t(({props:a})=>[e(p,V({label:"Letzter Login",class:"tw-cursor-pointer","model-value":M.value,"prepend-icon":"mdi-calendar",readonly:""},a),null,16,["model-value"])]),default:t(()=>[e(ne,{"onUpdate:modelValue":[l[12]||(l[12]=a=>j.value=!1),l[13]||(l[13]=a=>g.value=a)],modelValue:g.value},null,8,["modelValue"])]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),e(s,{cols:"12",sm:"4"},{default:t(()=>[e(ue,{locale:"de"},{default:t(()=>[e(re,{modelValue:q.value,"onUpdate:modelValue":l[17]||(l[17]=a=>q.value=a),"return-value":b.value,"close-on-content-click":!1},{activator:t(({props:a})=>[e(p,V({label:"Erster Login",class:"tw-cursor-pointer","model-value":Q.value,"prepend-icon":"mdi-calendar",readonly:""},a),null,16,["model-value"])]),default:t(()=>[e(ne,{"onUpdate:modelValue":[l[15]||(l[15]=a=>q.value=!1),l[16]||(l[16]=a=>b.value=a)],modelValue:b.value},null,8,["modelValue"])]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1})]),_:1})])]),e(Pe,{"items-per-page":B.value,"onUpdate:itemsPerPage":l[19]||(l[19]=a=>B.value=a),headers:we,page:L.value,"items-length":G.value,items:he.value,search:H.value,loading:F.value,class:"data-table-container elevation-1","item-value":"name","onUpdate:options":X},{item:t(({item:a})=>[u("tr",null,[u("td",Ze,[e(R,{size:"medium",class:xe({active:a.selectable.is_online})},{default:t(()=>[h("mdi-circle")]),_:2},1032,["class"])]),u("td",null,E(a.selectable.full_name),1),u("td",null,E(a.selectable.email),1),u("td",null,E(a.selectable.primary_role_human_name),1),u("td",null,E(!a.selectable.last_seen_at||a.selectable.last_seen_at==="-"?a.selectable.last_seen_at:m(Ee)(a.selectable.last_seen_at,"sv-SE")),1),u("td",null,E(!a.selectable.first_login_at||a.selectable.first_login_at==="-"?a.selectable.first_login_at:m(Le)(a.selectable.first_login_at,"fr-CA")),1),u("td",null,[o.$page.props.auth.user.is_super_admin||(o.$page.props.auth.user.is_admin||o.$page.props.auth.user.is_manager)&&!a.selectable.is_super_admin&&!a.selectable.is_admin||o.$page.props.auth.user.is_admin&&o.$page.props.auth.user.id===a.selectable.id?(C(),ve(ie,{key:0,location:"top"},{activator:t(({props:w})=>[e(m(Ae),{href:o.route("users.edit",{id:a.selectable.id})},{default:t(()=>[e(R,V(w,{size:"small",class:"tw-me-2"}),{default:t(()=>[h("mdi-pencil")]),_:2},1040)]),_:2},1032,["href"])]),default:t(()=>[Je]),_:2},1024)):_e("",!0),o.$page.props.auth.user.is_super_admin||o.$page.props.auth.user.is_admin||o.$page.props.auth.user.is_manager&&!a.selectable.is_super_admin&&!a.selectable.is_admin?(C(),ve(ie,{key:1,location:"top"},{activator:t(({props:w})=>[e(R,V(w,{size:"small",class:"tw-me-2",onClick:i=>ke(a.raw)}),{default:t(()=>[h("mdi-delete")]),_:2},1040,["onClick"])]),default:t(()=>[Ke]),_:2},1024)):_e("",!0)])])]),"no-data":t(()=>[u("div",Ge,[W.value?(C(),K("h3",He,"Die Tabelle ist leer.")):(C(),K(ce,{key:1},[Me,e(D,{color:"primary",onClick:l[18]||(l[18]=a=>X({page:1,itemsPerPage:B.value,clearFilters:!0}))},{default:t(()=>[h("Zurücksetzen")]),_:1})],64))])]),_:1},8,["items-per-page","page","items-length","items","search","loading"])])]),_:1},8,["errors"])],64)}}};export{ll as default};
