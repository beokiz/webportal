import{d as me}from"./index-bc862bfe.js";import{K as _e,k as c,h as D,m as pe,T as Q,r as n,o as N,f as T,a as e,u as d,w as t,F as W,Z as fe,b as o,p as b,d as f,y as ve,t as S,c as X,i as ge,g as Y,O as be}from"./app-46d088fc.js";import{f as he,b as we}from"./common-326e1711.js";import{_ as ye}from"./AuthenticatedLayout-54f64230.js";import"./ApplicationLogo-9374af9c.js";const ke=o("h2",{class:"tw-font-semibold tw-text-xl tw-text-gray-800 tw-leading-tight"},"Benutzer",-1),Ve={class:"tw-flex tw-items-center tw-justify-end"},Ue=o("span",{class:"tw-text-h5"},"Neuen Benutzer",-1),ze=o("p",null,"Sind Sie sicher, dass Sie den aktuellen Benutzer löschen möchten?",-1),Pe={class:"tw-table-block tw-max-w-full tw-mx-auto tw-py-6 tw-px-4 sm:tw-px-6 lg:tw-px-8"},Ne={class:"tw-bg-white tw-flex tw-justify-between tw-px-6 tw-py-6"},Se={class:"tw-w-full"},Be={class:"tw-ml-6"},xe={align:"center"},Ce=o("span",null,"Benutzer bearbeiten",-1),$e=o("span",null,"Benutzer löschen",-1),Ee={class:"tw-py-6"},Fe={key:0,class:"tw-mb-4"},De=o("h3",{class:"tw-mb-4"},"Die Tabelle ist leer. Bitte setzen Sie die Suchfilter zurück.",-1),Ie={__name:"Users",props:{items:Array,currentPage:Number,perPage:Number,lastPage:Number,total:Number,paging:Boolean,orderBy:String,sort:String,filters:Object,errors:Object,roles:Array},setup(A){const p=A;me.Inertia.on("success",s=>{let l=s.detail.page.props;s.detail.page.component==="Users/Users"&&l&&(B.value=l.currentPage,V.value=l.perPage,ee.value=l.orderBy,le.value=l.sort,O.value=l.total,te.value=l.lastPage,h.value=l.filters.full_name??null,w.value=l.filters.email??null)}),_e().props.auth.user;const B=c(p.currentPage),V=c(p.perPage),ee=c(p.orderBy),le=c(p.sort),O=c(p.total),te=c(p.lastPage),h=c(p.filters.full_name??null),w=c(p.filters.email??null),j=c(""),v=c(p.errors||{}),$=c(!1),x=c(!1),C=c(!1),ae=[{title:"Status",key:"is_online",width:"5%",sortable:!1,align:"center"},{title:"Name",key:"first_name",width:"25%",sortable:!1},{title:"Email",key:"email",width:"20%",sortable:!1},{title:"Rolle",key:"primary_role_name",width:"10%",sortable:!1},{title:"Letzter Login",key:"last_seen_at",width:"15%",sortable:!1},{title:"Erster Login",key:"first_login_at",width:"15%",sortable:!1},{title:"Aktionen",key:"actions",width:"10%",sortable:!1}],se=D(()=>p.items.map(s=>{const l={...s};for(const m in l)(l[m]===null||l[m]===void 0)&&(l[m]="-");return l})),q=D(()=>h.value===null&&w.value===null),oe=D(()=>h.value!==null||w.value!==null);pe(x,s=>{s||U()});const I=async({page:s,itemsPerPage:l,sortBy:m,clearFilters:g})=>{if(g&&(h.value=null,w.value=null),s===B.value&&g||q||oe){$.value=!0;let i={data:{page:s,per_page:l}};m&&m.length>0&&(i.data.order_by=m[0].key,i.data.sort=m[0].order),i.data.full_name=h.value,i.data.email=w.value,await be.reload(i),B.value=s,V.value=l,$.value=!1}},ne=s=>{y.id=s.id,C.value=!0},y=Q({id:null}),re=async()=>{y.processing=!0;let s={onSuccess:l=>{U()},onError:l=>{v.value=l},onFinish:()=>{y.processing=!1}};y.delete(route("users.destroy",{id:y.id}),s)},U=()=>{x.value=!1,C.value=!1,y.id=null,u.reset(),u.clearErrors(),v.value={}},u=Q({first_name:null,last_name:null,email:null,role:null,two_factor_auth_enabled:!1}),ue=async()=>{u.processing=!0;let s={onSuccess:l=>{U()},onError:l=>{v.value=l},onFinish:()=>{u.processing=!1}};u.post(route("users.store"),s)};return(s,l)=>{const m=n("v-card-title"),g=n("v-text-field"),i=n("v-col"),z=n("v-row"),ie=n("v-select"),de=n("v-checkbox"),L=n("v-container"),Z=n("v-card-text"),R=n("v-spacer"),P=n("v-btn"),k=n("v-hover"),K=n("v-btn-primary"),G=n("v-card-actions"),H=n("v-card"),J=n("v-dialog"),E=n("v-icon"),M=n("v-tooltip"),ce=n("v-data-table-server");return N(),T(W,null,[e(d(fe),{title:"Benutzer"}),e(ye,{errors:v.value},{header:t(()=>[ke,o("div",Ve,[e(k,null,{default:t(({isHovering:a,props:_})=>[e(P,b(_,{color:a?"accent":"primary",dark:""}),{default:t(()=>[f(" Neuen Benutzer hinzufügen "),e(J,{modelValue:x.value,"onUpdate:modelValue":l[5]||(l[5]=r=>x.value=r),activator:"parent",width:"80vw"},{default:t(()=>[e(H,{height:"80vh"},{default:t(()=>[e(m,null,{default:t(()=>[Ue]),_:1}),e(Z,null,{default:t(()=>[e(L,null,{default:t(()=>[e(z,null,{default:t(()=>[e(i,{cols:"12",sm:"6"},{default:t(()=>[e(g,{modelValue:d(u).first_name,"onUpdate:modelValue":l[0]||(l[0]=r=>d(u).first_name=r),"error-messages":v.value.first_name,label:"Vorname",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(i,{cols:"12",sm:"6"},{default:t(()=>[e(g,{modelValue:d(u).last_name,"onUpdate:modelValue":l[1]||(l[1]=r=>d(u).last_name=r),"error-messages":v.value.last_name,label:"Nachname",required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(z,null,{default:t(()=>[e(i,{cols:"12",sm:"6"},{default:t(()=>[e(g,{modelValue:d(u).email,"onUpdate:modelValue":l[2]||(l[2]=r=>d(u).email=r),"error-messages":v.value.email,label:"Email",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(i,{cols:"12",sm:"6"},{default:t(()=>[e(ie,{modelValue:d(u).role,"onUpdate:modelValue":l[3]||(l[3]=r=>d(u).role=r),items:A.roles,"error-messages":v.value.role,"item-title":"human_name","item-value":"id",label:"Role",required:""},null,8,["modelValue","items","error-messages"])]),_:1})]),_:1}),e(z,null,{default:t(()=>[e(i,{cols:"12",md:"4",sm:"6"},{default:t(()=>[e(de,{modelValue:d(u).two_factor_auth_enabled,"onUpdate:modelValue":l[4]||(l[4]=r=>d(u).two_factor_auth_enabled=r),label:"Zwei-Faktor-Authentifizierung",value:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(G,null,{default:t(()=>[e(R),e(k,null,{default:t(({isHovering:r,props:F})=>[e(P,b({onClick:U},F,{color:r?"accent":"primary"}),{default:t(()=>[f("Abbrechen")]),_:2},1040,["color"])]),_:2},1024),e(k,null,{default:t(({isHovering:r,props:F})=>[e(K,b({onClick:ue},F,{color:r?"accent":"primary"}),{default:t(()=>[f("Speichern")]),_:2},1040,["color"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1040,["color"])]),_:1})]),e(J,{modelValue:C.value,"onUpdate:modelValue":l[6]||(l[6]=a=>C.value=a),width:"20vw"},{default:t(()=>[e(H,{height:"30vh"},{default:t(()=>[e(Z,null,{default:t(()=>[e(L,null,{default:t(()=>[e(z,null,{default:t(()=>[e(i,{cols:"12"},{default:t(()=>[ze]),_:1})]),_:1})]),_:1})]),_:1}),e(G,null,{default:t(()=>[e(R),e(k,null,{default:t(({isHovering:a,props:_})=>[e(P,b({onClick:U},_,{color:a?"accent":"primary"}),{default:t(()=>[f("Abbrechen")]),_:2},1040,["color"])]),_:1}),e(k,null,{default:t(({isHovering:a,props:_})=>[e(K,b({onClick:re},_,{color:a?"accent":"primary"}),{default:t(()=>[f("Löschen")]),_:2},1040,["color"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),default:t(()=>[o("div",Pe,[o("div",Ne,[o("div",Se,[e(z,null,{default:t(()=>[e(i,{cols:"12",sm:"3"},{default:t(()=>[e(g,{modelValue:h.value,"onUpdate:modelValue":l[7]||(l[7]=a=>h.value=a),label:"Name"},null,8,["modelValue"])]),_:1}),e(i,{cols:"12",sm:"3"},{default:t(()=>[e(g,{modelValue:w.value,"onUpdate:modelValue":l[8]||(l[8]=a=>w.value=a),label:"Email"},null,8,["modelValue"])]),_:1})]),_:1})]),o("div",Be,[e(k,null,{default:t(({isHovering:a,props:_})=>[e(P,b({class:"tw-mt-2"},_,{color:a?"accent":"primary",onClick:l[9]||(l[9]=r=>j.value=String(Date.now())),dark:""}),{default:t(()=>[f("Suche")]),_:2},1040,["color"])]),_:1})])]),e(ce,{"items-per-page":V.value,"onUpdate:itemsPerPage":l[11]||(l[11]=a=>V.value=a),headers:ae,page:B.value,"items-length":O.value,items:se.value,search:j.value,loading:$.value,class:"data-table-container elevation-1","item-value":"name","onUpdate:options":I},{item:t(({item:a})=>[o("tr",null,[o("td",xe,[e(E,{size:"medium",class:ve({active:a.selectable.is_online})},{default:t(()=>[f("mdi-circle")]),_:2},1032,["class"])]),o("td",null,S(a.selectable.full_name),1),o("td",null,S(a.selectable.email),1),o("td",null,S(a.selectable.primary_role_human_name),1),o("td",null,S(!a.selectable.last_seen_at||a.selectable.last_seen_at==="-"?a.selectable.last_seen_at:d(he)(a.selectable.last_seen_at,"sv-SE")),1),o("td",null,S(!a.selectable.first_login_at||a.selectable.first_login_at==="-"?a.selectable.first_login_at:d(we)(a.selectable.first_login_at,"fr-CA")),1),o("td",null,[s.$page.props.auth.user.is_super_admin||(s.$page.props.auth.user.is_admin||s.$page.props.auth.user.is_manager)&&!a.selectable.is_super_admin&&!a.selectable.is_admin||s.$page.props.auth.user.is_admin&&s.$page.props.auth.user.id===a.selectable.id?(N(),X(M,{key:0,location:"top"},{activator:t(({props:_})=>[e(d(ge),{href:s.route("users.edit",{id:a.selectable.id})},{default:t(()=>[e(E,b(_,{size:"small",class:"tw-me-2"}),{default:t(()=>[f("mdi-pencil")]),_:2},1040)]),_:2},1032,["href"])]),default:t(()=>[Ce]),_:2},1024)):Y("",!0),s.$page.props.auth.user.is_super_admin||s.$page.props.auth.user.is_admin||s.$page.props.auth.user.is_manager&&!a.selectable.is_super_admin&&!a.selectable.is_admin?(N(),X(M,{key:1,location:"top"},{activator:t(({props:_})=>[e(E,b(_,{size:"small",class:"tw-me-2",onClick:r=>ne(a.raw)}),{default:t(()=>[f("mdi-delete")]),_:2},1040,["onClick"])]),default:t(()=>[$e]),_:2},1024)):Y("",!0)])])]),"no-data":t(()=>[o("div",Ee,[q.value?(N(),T("h3",Fe,"Die Tabelle ist leer.")):(N(),T(W,{key:1},[De,e(P,{color:"primary",onClick:l[10]||(l[10]=a=>I({page:1,itemsPerPage:V.value,clearFilters:!0}))},{default:t(()=>[f("Zurücksetzen")]),_:1})],64))])]),_:1},8,["items-per-page","page","items-length","items","search","loading"])])]),_:1},8,["errors"])],64)}}};export{Ie as default};
