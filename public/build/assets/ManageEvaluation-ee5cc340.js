import{d as se}from"./index-608046d9.js";import{K as oe,k as x,h as re,s as ie,l as ue,T as j,m as ce,r as d,o as U,f as P,a as e,u as m,w as t,F as de,Z as me,b as g,c as R,g as O,p as S,d as h,t as pe,v as ve}from"./app-072a1025.js";import{p as C,a as _e}from"./common-326e1711.js";import{_ as ge}from"./AuthenticatedLayout-31d17e9a.js";import{_ as T}from"./EvaluationDomainsList-71e85aca.js";import"./ApplicationLogo-323a588b.js";let I;const fe=new Uint8Array(16);function he(){if(!I&&(I=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!I))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return I(fe)}const c=[];for(let l=0;l<256;++l)c.push((l+256).toString(16).slice(1));function we(l,a=0){return c[l[a+0]]+c[l[a+1]]+c[l[a+2]]+c[l[a+3]]+"-"+c[l[a+4]]+c[l[a+5]]+"-"+c[l[a+6]]+c[l[a+7]]+"-"+c[l[a+8]]+c[l[a+9]]+"-"+c[l[a+10]]+c[l[a+11]]+c[l[a+12]]+c[l[a+13]]+c[l[a+14]]+c[l[a+15]]}const be=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),$={randomUUID:be};function ye(l,a,V){if($.randomUUID&&!a&&!l)return $.randomUUID();l=l||{};const f=l.random||(l.rng||he)();if(f[6]=f[6]&15|64,f[8]=f[8]&63|128,a){V=V||0;for(let u=0;u<16;++u)a[V+u]=f[u];return a}return we(f)}const ke=g("h2",{class:"tw-font-semibold tw-text-xl tw-text-gray-800 tw-leading-tight"},"Auswertung erstellen",-1),xe={class:"tw-table-block tw-max-w-full tw-mx-auto tw-py-6 tw-px-4 sm:tw-px-6 lg:tw-px-8"},Ve=g("h3",null,"Eigenschaften",-1),Ue={key:0,class:"tw-flex justify-center items-center tw-bg-white"},Se={class:"tw-text-right"},De=["href"],Ee={class:"tw-text-center"},ze=g("h1",{class:"tw-uppercase text-primary tw-font-black tw-text-xl tw-mb-8"}," Screening wurde eingereicht ",-1),Ie=g("p",{class:"tw-mb-8"}," Folgendes Screening wurde eingereicht und kann nur bis 15 Minuten nach Einreichung bearbeitet werden. Danach verschwindet es aus Ihrer Übersicht. Sollten Sie es zurückziehen oder bearbeiten wollen, klicke Sie auf 'Abgabe zurückziehen. Nachfolgend erhalten Sie eine Übersicht des eingereichten Screenings, welches Sie über den Download-Button als PDF herunterladen können. ",-1),Fe=g("span",{class:"tw-font-black"},"Bezeichner des Screenings",-1),Pe={__name:"ManageEvaluation",props:{evaluation:Object,kitas:Array,domains:Array,errors:Object},setup(l){const a=l;se.Inertia.on("success",r=>{r.detail.page.props,r.detail.page.component});const V=oe().props.auth.user??{},f=x(null),u=x(a.errors||{}),y=x(!1),A=x([]),D=x(!1),k=x(null),_=re(()=>!!a.evaluation);ie(()=>{_.value||H()}),ue(()=>{_.value||B()});const B=()=>{f.value=ye(),n.uuid=f.value},H=()=>{n.ratings=C(a.domains)},F=()=>{u.value={},D.value=!1},K=()=>{n.reset(),n.clearErrors(),u.value={},n.ratings=C(a.domains),_.value||B()},n=j({uuid:_.value?a.evaluation.uuid:null,user_id:_.value?a.evaluation.user_id:V.id,kita_id:_.value?a.evaluation.kita_id:null,age:_.value?a.evaluation.age:null,is_daz:_.value?a.evaluation.is_daz:!1,ratings:_.value?a.evaluation.data:[]});ce(()=>n.age,r=>{n.ratings=C(a.domains)});const Z=r=>{A.value=ve(r)?r.value:r},q=r=>{n.ratings=r},G=async()=>{n.processing=!0,y.value=!0;let r=[];A.value.map(o=>(o.subdomains.map(p=>(p.milestones.map(w=>(r.push(parseInt(w.id)),w)),p)),o)),n.ratings=n.ratings.map(o=>(o.milestones.map(p=>(r.includes(parseInt(p.id))||(p.value=0),p)),o));let i={onSuccess:o=>{n.clearErrors(),u.value={},D.value=!0,k.value=o.props.data},onError:o=>{u.value=o},onFinish:()=>{n.processing=!1,y.value=!1}};_.value?n.put(route("evaluations.update",{evaluation:a.evaluation.id}),i):n.post(route("evaluations.store"),i)},J=async()=>{n.processing=!0,y.value=!0,n.post(route("evaluations.save"),{preserveState:!1,onSuccess:r=>{n.clearErrors(),u.value={}},onError:r=>{u.value=r},onFinish:()=>{n.processing=!1,y.value=!1}})},E=j({}),L=async r=>{E.processing=!0,E.post(route("evaluations.unfinished",{id:r}),{preserveState:!1,onSuccess:i=>{E.clearErrors(),u.value={},F()},onError:i=>{u.value=i},onFinish:()=>{E.processing=!1,y.value=!1}})};return(r,i)=>{const o=d("v-col"),p=d("v-row"),w=d("v-container"),Q=d("v-text-field"),M=d("v-select"),W=d("v-checkbox"),X=d("v-progress-circular"),z=d("v-btn"),b=d("v-hover"),N=d("v-btn-primary"),Y=d("v-icon"),ee=d("v-card-text"),te=d("v-spacer"),ae=d("v-card-actions"),ne=d("v-card"),le=d("v-dialog");return U(),P(de,null,[e(m(me),{title:"Auswertung erstellen"}),e(ge,{errors:u.value},{header:t(()=>[ke]),default:t(()=>[g("div",xe,[e(w,null,{default:t(()=>[e(p,null,{default:t(()=>[e(o,{cols:"12"},{default:t(()=>[Ve]),_:1})]),_:1})]),_:1}),e(w,null,{default:t(()=>[e(p,null,{default:t(()=>[e(o,{cols:"12",sm:"3"},{default:t(()=>[e(Q,{modelValue:m(n).uuid,"onUpdate:modelValue":i[0]||(i[0]=s=>m(n).uuid=s),"error-messages":u.value.uuid,readonly:"",label:"Bezeichner der Einschatzung",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(o,{cols:"12",sm:"3"},{default:t(()=>[e(M,{modelValue:m(n).age,"onUpdate:modelValue":i[1]||(i[1]=s=>m(n).age=s),items:m(_e),"error-messages":u.value.age,"item-title":"age_name","item-value":"age_number",label:"Altersgruppe"},null,8,["modelValue","items","error-messages"])]),_:1}),e(o,{cols:"12",sm:"3"},{default:t(()=>[e(M,{modelValue:m(n).kita_id,"onUpdate:modelValue":i[2]||(i[2]=s=>m(n).kita_id=s),items:l.kitas,"error-messages":u.value.kita_id,"item-title":"name","item-value":"id",label:"Kita"},null,8,["modelValue","items","error-messages"])]),_:1}),e(o,{cols:"12",sm:"3"},{default:t(()=>[e(W,{modelValue:m(n).is_daz,"onUpdate:modelValue":i[3]||(i[3]=s=>m(n).is_daz=s),label:"Deutsch ist nicht Muttersprache"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{class:"manage-evaluation-domains"},{default:t(()=>[m(n).age?(U(),R(T,{key:0,ratings:m(n).ratings,age:m(n).age,domains:l.domains,errors:u.value,onUpdateDomainsData:Z,onUpdateRatingData:q},null,8,["ratings","age","domains","errors"])):O("",!0)]),_:1})]),_:1}),e(w,null,{default:t(()=>[y.value?(U(),P("div",Ue,[e(X,{indeterminate:"",size:40})])):(U(),R(p,{key:1},{default:t(()=>[e(o,{cols:"12",sm:"6"},{default:t(()=>[e(b,null,{default:t(({isHovering:s,props:v})=>[e(z,S({onClick:K},v,{color:s?"primary":"accent"}),{default:t(()=>[h(" Zurücksetzen ")]),_:2},1040,["color"])]),_:1})]),_:1}),e(o,{cols:"12",sm:"6",align:"right"},{default:t(()=>[e(b,null,{default:t(({isHovering:s,props:v})=>[e(z,S({class:"mr-2",onClick:J,variant:"text"},v,{color:s?"accent":"primary"}),{default:t(()=>[h(" Speichern ")]),_:2},1040,["color"])]),_:1}),m(n).age?(U(),R(b,{key:0},{default:t(({isHovering:s,props:v})=>[e(N,S({onClick:G},v,{color:s?"accent":"primary"}),{default:t(()=>[h(" Prüfen und Einreichen ")]),_:2},1040,["color"])]),_:1})):O("",!0)]),_:1})]),_:1}))]),_:1})]),e(le,{modelValue:D.value,"onUpdate:modelValue":i[6]||(i[6]=s=>D.value=s),width:"95vw"},{default:t(()=>[e(ne,{height:"95vh"},{default:t(()=>[e(ee,null,{default:t(()=>[e(w,null,{default:t(()=>[e(p,{class:"result-evaluation-domains"},{default:t(()=>[e(o,{cols:"12"},{default:t(()=>[e(b,null,{default:t(({isHovering:s,props:v})=>[g("div",Se,[g("a",{href:r.route("evaluations.pdf",{id:k.value.item.id}),onClick:F,title:"Fenster schließen"},[e(Y,S(v,{size:"small",class:"tw-me-2",onClick:i[4]||(i[4]=()=>{})}),{default:t(()=>[h("mdi-close")]),_:2},1040)],8,De)])]),_:1})]),_:1})]),_:1}),e(p,{class:"result-evaluation-domains"},{default:t(()=>[e(o,{cols:"8",offset:"2"},{default:t(()=>[g("div",Ee,[ze,Ie,e(b,null,{default:t(({isHovering:s,props:v})=>[e(z,{href:r.route("evaluations.pdf",{id:k.value.item.id}),class:"tw-px-2 tw-py-3 tw-mb-4 tw-mr-4 tw-normal-case",color:s?"primary":"accent"},{default:t(()=>[h(" Screening als PDF downloaden ")]),_:2},1032,["href","color"])]),_:1}),e(b,null,{default:t(({isHovering:s,props:v})=>[e(z,{onClick:i[5]||(i[5]=Re=>L(k.value.item.id)),class:"tw-px-2 tw-py-3 tw-mb-4 tw-normal-case",color:s?"accent":"primary"},{default:t(()=>[h(" Abgabe zurückziehen ")]),_:2},1032,["color"])]),_:1})])]),_:1}),e(o,{cols:"12"},{default:t(()=>[g("p",null,[Fe,h(": "+pe(k.value.item.uuid),1)])]),_:1}),e(o,{cols:"12"},{default:t(()=>[e(T,{ratings:k.value.item.data,age:m(n).age,domains:l.domains,disabled:!0},null,8,["ratings","age","domains"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ae,null,{default:t(()=>[e(te),e(b,null,{default:t(({isHovering:s,props:v})=>[e(N,S({onClick:F},v,{color:s?"accent":"primary"}),{default:t(()=>[h("Abbrechen")]),_:2},1040,["color"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["errors"])],64)}}};export{Pe as default};
