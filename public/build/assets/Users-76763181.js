import{d as Ce}from"./index-9c8e1ce1.js";import{K as Le,j as r,k as Q,l as $,A as ve,T as Z,r as u,o as U,f as X,a as e,u as m,w as l,F as fe,Z as Be,b as n,m as v,d as f,q as Ae,t as D,c as x,h as T,i as De,O as xe}from"./app-abbb3540.js";import{c as ge,b as Te,f as Oe}from"./common-ea192878.js";import{_ as je}from"./AuthenticatedLayout-220584ad.js";import"./ApplicationLogo-4527fb70.js";const qe=n("h2",{class:"tw-font-semibold tw-text-xl tw-text-gray-800 tw-leading-tight"},"Benutzer",-1),Ie={class:"tw-flex tw-items-center tw-justify-end"},Ze=n("span",{class:"tw-text-h5"},"Neuen Benutzer",-1),Re=n("p",null,"Sind Sie sicher, dass Sie den aktuellen Benutzer löschen möchten?",-1),We={class:"tw-table-block tw-max-w-full tw-mx-auto tw-py-6 tw-px-4 sm:tw-px-6 lg:tw-px-8"},Je={class:"tw-bg-white tw-flex tw-justify-between tw-px-6 tw-py-6"},Ke={class:"tw-w-full"},Ge={align:"center"},He={class:"tw-flex tw-items-center"},Me=n("span",null,"Verifizierungsmail erneut senden",-1),Qe={class:"tw-text-center"},Xe=n("span",null,"Verifikations-Email erneut senden",-1),Ye=n("span",null,"Zulassung senden",-1),el=n("span",null,"Benutzer bearbeiten",-1),ll=n("span",null,"Benutzer löschen",-1),al={class:"tw-py-6"},tl={key:0,class:"tw-mb-4"},ol=n("h3",{class:"tw-mb-4"},"Die Tabelle ist leer. Bitte setzen Sie die Suchfilter zurück.",-1),dl={__name:"Users",props:{items:Array,currentPage:Number,perPage:Number,lastPage:Number,total:Number,paging:Boolean,orderBy:String,sort:String,filters:Object,errors:Object,roles:Array},setup(R){const g=R;Ce.Inertia.on("success",o=>{let a=o.detail.page.props;o.detail.page.component==="Users/Users"&&a&&(O.value=a.currentPage,L.value=a.perPage,be.value=a.orderBy,we.value=a.sort,Y.value=a.total,he.value=a.lastPage)}),Le().props.auth.user;const O=r(g.currentPage),L=r(g.perPage),be=r(g.orderBy),we=r(g.sort),Y=r(g.total),he=r(g.lastPage),k=r(g.filters.status??null),y=r(g.filters.full_name??null),F=r(g.filters.email??null),S=r(null),ee=r(""),b=r(g.errors||{}),W=r(!1),J=r(!1),z=r(!1),j=r(!1),q=r(!1),le=r(null),ae=r(null),V=r(null),h=r(null),Ve=[{title:"Status",key:"is_online",width:"5%",sortable:!1,align:"center"},{title:"Name",key:"first_name",width:"20%",sortable:!0},{title:"Email",key:"email",width:"30%",sortable:!0},{title:"Rolle",key:"primary_role_name",width:"10%",sortable:!0},{title:"Letzter Login",key:"last_seen_at",width:"15%",sortable:!0},{title:"Erster Login",key:"first_login_at",width:"10%",sortable:!0},{title:"Aktionen",key:"actions",width:"10%",sortable:!1,align:"center"}],ke=[{title:"Ja",value:"true"},{title:"Nein",value:"false"}],ye=Q(()=>g.items.map(o=>{const a={...o};for(const c in a)(a[c]===null||a[c]===void 0)&&(a[c]="-");return a})),te=Q(()=>k.value===null&&y.value===null&&F.value===null&&S.value===null&&V.value===null&&h.value===null),Fe=Q(()=>k.value!==null||y.value!==null||F.value!==null||S.value!==null||V.value!==null||h.value!==null);$(j,o=>{o||P()}),$(k,o=>{E()}),$(y,ve.debounce(o=>{E()},500)),$(F,ve.debounce(o=>{E()},500)),$(S,o=>{E()}),$(V,o=>{le.value=o?ge(o):null,E()}),$(h,o=>{ae.value=o?ge(o):null,E()});const E=()=>{z.value=!0,ee.value=String(Date.now())},oe=async({page:o,itemsPerPage:a,sortBy:c,clearFilters:w})=>{if(w&&(k.value=null,y.value=null,F.value=null,S.value=null,V.value=null,h.value=null),o===O.value&&w||te||Fe){z.value=!0;let s={page:o,per_page:a};c&&c.length>0?(s.order_by=c[0].key,s.sort=c[0].order):(s.order_by=null,s.sort=null),k.value&&(s.status=k.value),y.value&&(s.full_name=y.value),F.value&&(s.email=F.value),S.value&&(s.with_roles=S.value),V.value&&(s.first_login_at=V.value.toLocaleString()),h.value&&(console.log(h.value.toLocaleString()),s.last_seen_at=h.value.toLocaleString()),await xe.get(route(route().current()),s,{preserveScroll:!0,preserveState:!0,onCancelToken:p=>{},onCancel:()=>{},onBefore:p=>{z.value=!0},onStart:p=>{},onProgress:p=>{},onSuccess:p=>{O.value=s.page,L.value=s.per_page},onError:p=>{console.log(p)},onFinish:p=>{z.value=!1}})}},Se=o=>{N.id=o.id,q.value=!0},N=Z({id:null}),Ue=async()=>{N.processing=!0;let o={onSuccess:a=>{P()},onError:a=>{b.value=a},onFinish:()=>{N.processing=!1}};N.delete(route("users.destroy",{id:N.id}),o)},P=()=>{j.value=!1,q.value=!1,N.id=null,d.reset(),d.clearErrors(),b.value={}},d=Z({first_name:null,last_name:null,email:null,role:null,two_factor_auth_enabled:!1,phone_number:null}),ze=async()=>{d.processing=!0;let o={onSuccess:a=>{P()},onError:a=>{b.value=a},onFinish:()=>{d.processing=!1}};d.post(route("users.store"),o)},K=Z({}),Pe=async o=>{K.processing=!0;let a={onSuccess:c=>{P()},onError:c=>{b.value=c},onFinish:()=>{K.processing=!1}};K.post(route("users.send_verification_link",{user:o==null?void 0:o.id}),a)},G=Z({}),$e=async o=>{G.processing=!0;let a={onSuccess:c=>{P()},onError:c=>{b.value=c},onFinish:()=>{G.processing=!1}};G.post(route("users.send_welcome_notification",{user:o==null?void 0:o.id}),a)};return(o,a)=>{const c=u("v-card-title"),w=u("v-text-field"),s=u("v-col"),p=u("v-row"),H=u("v-select"),Ee=u("v-checkbox"),se=u("v-container"),ne=u("v-card-text"),re=u("v-spacer"),I=u("v-btn"),B=u("v-hover"),ue=u("v-btn-primary"),ie=u("v-card-actions"),de=u("v-card"),ce=u("v-dialog"),me=u("v-date-picker"),_e=u("v-menu"),pe=u("v-locale-provider"),C=u("v-icon"),A=u("v-tooltip"),Ne=u("v-data-table-server");return U(),X(fe,null,[e(m(Be),{title:"Benutzer"}),e(je,{errors:b.value},{header:l(()=>[qe,n("div",Ie,[e(B,null,{default:l(({isHovering:t,props:_})=>[e(I,v(_,{color:t?"accent":"primary",dark:""}),{default:l(()=>[f(" Neuen Benutzer hinzufügen "),e(ce,{modelValue:j.value,"onUpdate:modelValue":a[6]||(a[6]=i=>j.value=i),activator:"parent",width:"80vw"},{default:l(()=>[e(de,{height:"80vh"},{default:l(()=>[e(c,null,{default:l(()=>[Ze]),_:1}),e(ne,null,{default:l(()=>[e(se,null,{default:l(()=>[e(p,null,{default:l(()=>[e(s,{cols:"12",sm:"6"},{default:l(()=>[e(w,{modelValue:m(d).first_name,"onUpdate:modelValue":a[0]||(a[0]=i=>m(d).first_name=i),"error-messages":b.value.first_name,label:"Vorname",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12",sm:"6"},{default:l(()=>[e(w,{modelValue:m(d).last_name,"onUpdate:modelValue":a[1]||(a[1]=i=>m(d).last_name=i),"error-messages":b.value.last_name,label:"Nachname",required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(s,{cols:"12",sm:"6"},{default:l(()=>[e(w,{modelValue:m(d).email,"onUpdate:modelValue":a[2]||(a[2]=i=>m(d).email=i),"error-messages":b.value.email,label:"Email",required:""},null,8,["modelValue","error-messages"])]),_:1}),e(s,{cols:"12",sm:"6"},{default:l(()=>[e(w,{modelValue:m(d).phone_number,"onUpdate:modelValue":a[3]||(a[3]=i=>m(d).phone_number=i),"error-messages":b.value.phone_number,label:"Telefonnummer"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(s,{cols:"12",sm:"6"},{default:l(()=>[e(H,{modelValue:m(d).role,"onUpdate:modelValue":a[4]||(a[4]=i=>m(d).role=i),items:R.roles,"error-messages":b.value.role,"item-title":"human_name","item-value":"id",label:"Role",required:""},null,8,["modelValue","items","error-messages"])]),_:1}),e(s,{cols:"12",md:"4",sm:"6"},{default:l(()=>[e(Ee,{modelValue:m(d).two_factor_auth_enabled,"onUpdate:modelValue":a[5]||(a[5]=i=>m(d).two_factor_auth_enabled=i),label:"Zwei-Faktor-Authentifizierung",value:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(ie,null,{default:l(()=>[e(re),e(B,null,{default:l(({isHovering:i,props:M})=>[e(I,v({onClick:P},M,{color:i?"accent":"primary"}),{default:l(()=>[f("Abbrechen")]),_:2},1040,["color"])]),_:2},1024),e(B,null,{default:l(({isHovering:i,props:M})=>[e(ue,v({onClick:ze},M,{color:i?"accent":"primary"}),{default:l(()=>[f("Speichern")]),_:2},1040,["color"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue"])]),_:2},1040,["color"])]),_:1})]),e(ce,{modelValue:q.value,"onUpdate:modelValue":a[7]||(a[7]=t=>q.value=t),width:"20vw"},{default:l(()=>[e(de,{height:"30vh"},{default:l(()=>[e(ne,null,{default:l(()=>[e(se,null,{default:l(()=>[e(p,null,{default:l(()=>[e(s,{cols:"12"},{default:l(()=>[Re]),_:1})]),_:1})]),_:1})]),_:1}),e(ie,null,{default:l(()=>[e(re),e(B,null,{default:l(({isHovering:t,props:_})=>[e(I,v({onClick:P},_,{color:t?"accent":"primary"}),{default:l(()=>[f("Abbrechen")]),_:2},1040,["color"])]),_:1}),e(B,null,{default:l(({isHovering:t,props:_})=>[e(ue,v({onClick:Ue},_,{color:t?"accent":"primary"}),{default:l(()=>[f("Löschen")]),_:2},1040,["color"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),default:l(()=>[n("div",We,[n("div",Je,[n("div",Ke,[e(p,null,{default:l(()=>[e(s,{cols:"12",sm:"4"},{default:l(()=>[e(H,{modelValue:k.value,"onUpdate:modelValue":a[8]||(a[8]=t=>k.value=t),items:ke,"item-title":"title","item-value":"value",label:"Status",multiple:"",disabled:z.value,clearable:""},null,8,["modelValue","disabled"])]),_:1}),e(s,{cols:"12",sm:"4"},{default:l(()=>[e(w,{modelValue:y.value,"onUpdate:modelValue":a[9]||(a[9]=t=>y.value=t),label:"Name",clearable:""},null,8,["modelValue"])]),_:1}),e(s,{cols:"12",sm:"4"},{default:l(()=>[e(w,{modelValue:F.value,"onUpdate:modelValue":a[10]||(a[10]=t=>F.value=t),label:"Email",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,null,{default:l(()=>[e(s,{cols:"12",sm:"4"},{default:l(()=>[e(H,{modelValue:S.value,"onUpdate:modelValue":a[11]||(a[11]=t=>S.value=t),items:R.roles,"item-title":"human_name","item-value":"name",label:"Rolle",multiple:"",disabled:z.value,clearable:""},null,8,["modelValue","items","disabled"])]),_:1}),e(s,{cols:"12",sm:"4"},{default:l(()=>[e(pe,{locale:"de"},{default:l(()=>[e(_e,{modelValue:W.value,"onUpdate:modelValue":a[14]||(a[14]=t=>W.value=t),"return-value":V.value,"close-on-content-click":!1},{activator:l(({props:t})=>[e(w,v({label:"Erster Login",class:"tw-cursor-pointer","model-value":le.value,"prepend-icon":"mdi-calendar",readonly:""},t),null,16,["model-value"])]),default:l(()=>[e(me,{"onUpdate:modelValue":[a[12]||(a[12]=t=>W.value=!1),a[13]||(a[13]=t=>V.value=t)],modelValue:V.value},null,8,["modelValue"])]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1}),e(s,{cols:"12",sm:"4"},{default:l(()=>[e(pe,{locale:"de"},{default:l(()=>[e(_e,{modelValue:J.value,"onUpdate:modelValue":a[17]||(a[17]=t=>J.value=t),"return-value":h.value,"close-on-content-click":!1},{activator:l(({props:t})=>[e(w,v({label:"Letzter Login",class:"tw-cursor-pointer","model-value":ae.value,"prepend-icon":"mdi-calendar",readonly:""},t),null,16,["model-value"])]),default:l(()=>[e(me,{"onUpdate:modelValue":[a[15]||(a[15]=t=>J.value=!1),a[16]||(a[16]=t=>h.value=t)],modelValue:h.value},null,8,["modelValue"])]),_:1},8,["modelValue","return-value"])]),_:1})]),_:1})]),_:1})])]),e(Ne,{"items-per-page":L.value,"onUpdate:itemsPerPage":a[19]||(a[19]=t=>L.value=t),headers:Ve,page:O.value,"items-length":Y.value,items:ye.value,search:ee.value,loading:z.value,class:"data-table-container elevation-1","item-value":"name","onUpdate:options":oe},{item:l(({item:t})=>[n("tr",null,[n("td",Ge,[e(C,{size:"medium",class:Ae({active:t.is_online})},{default:l(()=>[f("mdi-circle")]),_:2},1032,["class"])]),n("td",null,D(t.full_name),1),n("td",null,[n("div",He,[!t.email_verified_at||t.email_verified_at==="-"?(U(),x(A,{key:0},{activator:l(({props:_})=>[e(C,v(_,{size:"small",class:"tw-me-2"}),{default:l(()=>[f("mdi-alert-circle")]),_:2},1040)]),default:l(()=>[Me]),_:1})):T("",!0),n("span",null,D(t.email),1)])]),n("td",null,D(t.primary_role_human_name),1),n("td",null,D(!t.last_seen_at||t.last_seen_at==="-"?t.last_seen_at:m(Te)(t.last_seen_at,"de-DE")),1),n("td",null,D(!t.first_login_at||t.first_login_at==="-"?t.first_login_at:m(Oe)(t.first_login_at,"de-DE")),1),n("td",Qe,[(o.$page.props.auth.user.is_super_admin||o.$page.props.auth.user.is_admin)&&(!t.email_verified_at||t.email_verified_at==="-")?(U(),x(A,{key:0,location:"top"},{activator:l(({props:_})=>[e(C,v(_,{size:"small",class:"tw-me-2",onClick:i=>Pe(t)}),{default:l(()=>[f("mdi-email-sync-outline")]),_:2},1040,["onClick"])]),default:l(()=>[Xe]),_:2},1024)):T("",!0),(o.$page.props.auth.user.is_super_admin||o.$page.props.auth.user.is_admin)&&o.$page.props.auth.user.id!==t.id?(U(),x(A,{key:1,location:"top"},{activator:l(({props:_})=>[e(C,v(_,{size:"small",class:"tw-me-2",onClick:i=>$e(t)}),{default:l(()=>[f("mdi-account-check-outline ")]),_:2},1040,["onClick"])]),default:l(()=>[Ye]),_:2},1024)):T("",!0),o.$page.props.auth.user.is_super_admin||(o.$page.props.auth.user.is_admin||o.$page.props.auth.user.is_manager)&&!t.is_super_admin&&!t.is_admin||o.$page.props.auth.user.is_admin&&o.$page.props.auth.user.id===t.id?(U(),x(A,{key:2,location:"top"},{activator:l(({props:_})=>[e(m(De),{href:o.route("users.edit",{id:t.id})},{default:l(()=>[e(C,v(_,{size:"small",class:"tw-me-2"}),{default:l(()=>[f("mdi-pencil")]),_:2},1040)]),_:2},1032,["href"])]),default:l(()=>[el]),_:2},1024)):T("",!0),o.$page.props.auth.user.is_super_admin||o.$page.props.auth.user.is_admin||o.$page.props.auth.user.is_manager&&!t.is_super_admin&&!t.is_admin?(U(),x(A,{key:3,location:"top"},{activator:l(({props:_})=>[e(C,v(_,{size:"small",class:"tw-me-2",onClick:i=>Se(t)}),{default:l(()=>[f("mdi-delete")]),_:2},1040,["onClick"])]),default:l(()=>[ll]),_:2},1024)):T("",!0)])])]),"no-data":l(()=>[n("div",al,[te.value?(U(),X("h3",tl,"Die Tabelle ist leer.")):(U(),X(fe,{key:1},[ol,e(I,{color:"primary",onClick:a[18]||(a[18]=t=>oe({page:1,itemsPerPage:L.value,clearFilters:!0}))},{default:l(()=>[f("Zurücksetzen")]),_:1})],64))])]),_:1},8,["items-per-page","page","items-length","items","search","loading"])])]),_:1},8,["errors"])],64)}}};export{dl as default};
